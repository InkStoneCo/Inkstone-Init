{
  "version": 3,
  "sources": ["../src/extension.ts", "../src/store.ts", "../../codemind-core/src/parser/index.ts", "../../codemind-core/src/writer/index.ts", "../../codemind-core/src/store/index.ts", "../../codemind-core/src/linker/index.ts", "../../codemind-core/src/id/index.ts", "../src/providers/completion.ts", "../src/providers/hover.ts", "../src/providers/codelens.ts", "../src/providers/definition.ts", "../src/providers/reference.ts", "../src/providers/tree.ts"],
  "sourcesContent": ["// VSCode Extension entry point\n// Phase 5.1 \u5BE6\u4F5C\n\nimport * as vscode from 'vscode';\nimport {\n  extensionStore,\n  getNoteDefinitionLocation,\n  findNoteReferences,\n  getRelativeFilePath,\n} from './store.js';\nimport {\n  NoteCompletionProvider,\n  NoteHoverProvider,\n  NoteCodeLensProvider,\n  NoteDefinitionProvider,\n  NoteReferenceProvider,\n  NoteTreeProvider,\n  clearHoverCache,\n} from './providers/index.js';\nimport type { NoteId } from '@inkstone/codemind-core';\n\n/**\n * Quick pick item with note ID\n */\ninterface NoteQuickPickItem extends vscode.QuickPickItem {\n  noteId: NoteId;\n}\n\n/**\n * Extension activation\n */\nexport async function activate(context: vscode.ExtensionContext) {\n  console.log('Code-Mind extension is activating...');\n\n  // Initialize the store\n  const initialized = await extensionStore.initialize();\n  if (!initialized) {\n    console.log('Code-Mind: No codemind.md found in workspace');\n    // Still register commands but show warning when used\n    registerFallbackCommands(context);\n    return;\n  }\n\n  console.log('Code-Mind extension is now active');\n\n  // Document selector for all supported file types\n  const documentSelector: vscode.DocumentSelector = [\n    { scheme: 'file', language: 'markdown' },\n    { scheme: 'file', language: 'typescript' },\n    { scheme: 'file', language: 'typescriptreact' },\n    { scheme: 'file', language: 'javascript' },\n    { scheme: 'file', language: 'javascriptreact' },\n    { scheme: 'file', language: 'python' },\n    { scheme: 'file', language: 'go' },\n    { scheme: 'file', language: 'rust' },\n    { scheme: 'file', language: 'java' },\n  ];\n\n  // Register Completion Provider\n  const completionProvider = vscode.languages.registerCompletionItemProvider(\n    documentSelector,\n    new NoteCompletionProvider(),\n    '[' // Trigger on [\n  );\n\n  // Register Hover Provider\n  const hoverProvider = vscode.languages.registerHoverProvider(\n    documentSelector,\n    new NoteHoverProvider()\n  );\n\n  // Register CodeLens Provider\n  const codeLensProvider = vscode.languages.registerCodeLensProvider(\n    documentSelector,\n    new NoteCodeLensProvider()\n  );\n\n  // Register Definition Provider\n  const definitionProvider = vscode.languages.registerDefinitionProvider(\n    documentSelector,\n    new NoteDefinitionProvider()\n  );\n\n  // Register Reference Provider\n  const referenceProvider = vscode.languages.registerReferenceProvider(\n    documentSelector,\n    new NoteReferenceProvider()\n  );\n\n  // Register Tree View\n  const treeProvider = new NoteTreeProvider();\n  const treeView = vscode.window.createTreeView('codemind-notes', {\n    treeDataProvider: treeProvider,\n    showCollapseAll: true,\n  });\n\n  // Register Commands\n  const addNoteCommand = vscode.commands.registerCommand('codemind.addNote', addNoteHandler);\n\n  const goToNoteCommand = vscode.commands.registerCommand('codemind.goToNote', goToNoteHandler);\n\n  const findReferencesCommand = vscode.commands.registerCommand(\n    'codemind.findReferences',\n    findReferencesHandler\n  );\n\n  const refreshTreeCommand = vscode.commands.registerCommand('codemind.refreshTree', () =>\n    treeProvider.refresh()\n  );\n\n  // Subscribe all disposables\n  context.subscriptions.push(\n    completionProvider,\n    hoverProvider,\n    codeLensProvider,\n    definitionProvider,\n    referenceProvider,\n    treeView,\n    addNoteCommand,\n    goToNoteCommand,\n    findReferencesCommand,\n    refreshTreeCommand,\n    // Cleanup on store change\n    extensionStore.onDidChange(() => clearHoverCache())\n  );\n\n  // Show welcome message\n  vscode.window.showInformationMessage(\n    `Code-Mind: Found ${extensionStore.getAllNotes().length} notes`\n  );\n}\n\n/**\n * Register fallback commands when no codemind.md is found\n */\nfunction registerFallbackCommands(context: vscode.ExtensionContext) {\n  const showWarning = () => {\n    vscode.window.showWarningMessage(\n      'Code-Mind: No codemind.md found. Run \"codemind init\" in terminal.'\n    );\n  };\n\n  context.subscriptions.push(\n    vscode.commands.registerCommand('codemind.addNote', showWarning),\n    vscode.commands.registerCommand('codemind.goToNote', showWarning),\n    vscode.commands.registerCommand('codemind.findReferences', showWarning)\n  );\n}\n\n/**\n * Add Note command handler\n */\nasync function addNoteHandler() {\n  const editor = vscode.window.activeTextEditor;\n  if (!editor) {\n    vscode.window.showWarningMessage('No active editor');\n    return;\n  }\n\n  // Get the content to use for the note\n  const selection = editor.selection;\n  let content = '';\n\n  if (!selection.isEmpty) {\n    content = editor.document.getText(selection);\n  } else {\n    // Prompt for content\n    content =\n      (await vscode.window.showInputBox({\n        prompt: 'Enter note content',\n        placeHolder: 'Note content...',\n      })) || '';\n  }\n\n  if (!content) {\n    return;\n  }\n\n  // Get the file path\n  const filePath = getRelativeFilePath(editor.document.uri.fsPath);\n\n  // Add the note\n  const note = extensionStore.addNote(filePath, content);\n  if (note) {\n    vscode.window.showInformationMessage(`Created note: [[${note.properties.id}]]`);\n\n    // Insert reference at cursor if no selection\n    if (selection.isEmpty) {\n      editor.edit(editBuilder => {\n        editBuilder.insert(selection.active, `[[${note.properties.id}|${note.displayPath}]]`);\n      });\n    }\n  } else {\n    vscode.window.showErrorMessage('Failed to create note');\n  }\n}\n\n/**\n * Go to Note command handler\n */\nasync function goToNoteHandler(noteId?: NoteId) {\n  // If no ID provided, show quick pick\n  if (!noteId) {\n    const notes = extensionStore.getAllNotes();\n    const items: NoteQuickPickItem[] = notes.map(note => ({\n      label: note.displayPath,\n      description: note.properties.file || '',\n      detail: note.content[0]?.content || 'No content',\n      noteId: note.properties.id,\n    }));\n\n    const selected = await vscode.window.showQuickPick(items, {\n      placeHolder: 'Select a note to go to',\n      matchOnDescription: true,\n      matchOnDetail: true,\n    });\n\n    if (!selected) {\n      return;\n    }\n\n    noteId = selected.noteId;\n  }\n\n  // Navigate to the note definition\n  const location = await getNoteDefinitionLocation(noteId);\n  if (location) {\n    const document = await vscode.workspace.openTextDocument(location.uri);\n    const editor = await vscode.window.showTextDocument(document);\n    editor.selection = new vscode.Selection(location.range.start, location.range.start);\n    editor.revealRange(location.range, vscode.TextEditorRevealType.InCenter);\n  } else {\n    vscode.window.showWarningMessage(`Note not found: ${noteId}`);\n  }\n}\n\n/**\n * Find References command handler\n */\nasync function findReferencesHandler(noteId?: NoteId) {\n  // If no ID provided, try to get from cursor position\n  if (!noteId) {\n    const editor = vscode.window.activeTextEditor;\n    if (!editor) {\n      vscode.window.showWarningMessage('No active editor');\n      return;\n    }\n\n    // Try to find note ID at cursor\n    const position = editor.selection.active;\n    const line = editor.document.lineAt(position.line).text;\n    const pattern = /\\[\\[(cm\\.[a-z0-9]+)(?:\\|[^\\]]+)?\\]\\]/g;\n    let match;\n\n    while ((match = pattern.exec(line)) !== null) {\n      const start = match.index;\n      const end = start + match[0].length;\n      if (position.character >= start && position.character <= end) {\n        noteId = match[1] as NoteId;\n        break;\n      }\n    }\n\n    if (!noteId) {\n      // Show quick pick to select a note\n      const notes = extensionStore.getAllNotes();\n      const items: NoteQuickPickItem[] = notes.map(note => ({\n        label: note.displayPath,\n        description: `${note.properties.backlink_count || 0} references`,\n        noteId: note.properties.id,\n      }));\n\n      const selected = await vscode.window.showQuickPick(items, {\n        placeHolder: 'Select a note to find references',\n      });\n\n      if (!selected) {\n        return;\n      }\n\n      noteId = selected.noteId;\n    }\n  }\n\n  // Find all references\n  const locations = await findNoteReferences(noteId);\n\n  if (locations.length === 0) {\n    vscode.window.showInformationMessage(`No references found for ${noteId}`);\n    return;\n  }\n\n  // Show peek view with references\n  const editor = vscode.window.activeTextEditor;\n  if (editor) {\n    await vscode.commands.executeCommand(\n      'editor.action.peekLocations',\n      editor.document.uri,\n      editor.selection.active,\n      locations,\n      'peek'\n    );\n  }\n}\n\n/**\n * Extension deactivation\n */\nexport function deactivate() {\n  console.log('Code-Mind extension is deactivating...');\n  extensionStore.dispose();\n  console.log('Code-Mind extension deactivated');\n}\n", "// Shared Store module for VSCode extension\n// Phase 5.1 \u5BE6\u4F5C\n\nimport * as vscode from 'vscode';\nimport * as path from 'path';\nimport { createNoteStore, type NoteStore, type Note, type NoteId } from '@inkstone/codemind-core';\n\n/**\n * Extension store manager\n * Provides a singleton NoteStore instance for all providers\n */\nclass ExtensionStore {\n  private store: NoteStore | null = null;\n  private codemindPath: string | null = null;\n  private watcher: vscode.FileSystemWatcher | null = null;\n  private _onDidChange = new vscode.EventEmitter<void>();\n  readonly onDidChange = this._onDidChange.event;\n\n  /**\n   * Initialize the store with the workspace codemind.md path\n   */\n  async initialize(): Promise<boolean> {\n    const workspaceFolders = vscode.workspace.workspaceFolders;\n    if (!workspaceFolders || workspaceFolders.length === 0) {\n      return false;\n    }\n\n    // Find codemind.md in workspace\n    for (const folder of workspaceFolders) {\n      const codemindPath = path.join(folder.uri.fsPath, 'codemind.md');\n      try {\n        await vscode.workspace.fs.stat(vscode.Uri.file(codemindPath));\n        this.codemindPath = codemindPath;\n        break;\n      } catch {\n        // File doesn't exist, try next folder\n      }\n    }\n\n    if (!this.codemindPath) {\n      return false;\n    }\n\n    // Create the NoteStore\n    this.store = createNoteStore(this.codemindPath, { autoSave: true });\n\n    // Debug: log loaded notes\n    const allNotes = this.store.getAllNotes();\n    console.log(`[ExtensionStore] Initialized with ${allNotes.length} notes from ${this.codemindPath}`);\n    if (allNotes.length > 0) {\n      console.log(`[ExtensionStore] First 3 note IDs:`, allNotes.slice(0, 3).map(n => n.properties.id));\n    }\n\n    // Watch for changes to codemind.md\n    this.watcher = vscode.workspace.createFileSystemWatcher(this.codemindPath);\n    this.watcher.onDidChange(() => this.reload());\n    this.watcher.onDidCreate(() => this.reload());\n    this.watcher.onDidDelete(() => this.dispose());\n\n    return true;\n  }\n\n  /**\n   * Reload the store\n   */\n  reload(): void {\n    if (this.codemindPath) {\n      this.store = createNoteStore(this.codemindPath, { autoSave: true });\n      this._onDidChange.fire();\n    }\n  }\n\n  /**\n   * Get the NoteStore instance\n   */\n  getStore(): NoteStore | null {\n    return this.store;\n  }\n\n  /**\n   * Get the codemind.md path\n   */\n  getCodemindPath(): string | null {\n    return this.codemindPath;\n  }\n\n  /**\n   * Get all notes\n   */\n  getAllNotes(): Note[] {\n    return this.store?.getAllNotes() || [];\n  }\n\n  /**\n   * Get a note by ID\n   */\n  getNote(id: NoteId): Note | null {\n    return this.store?.getNote(id) || null;\n  }\n\n  /**\n   * Get notes in a specific file\n   */\n  getNotesInFile(filePath: string): Note[] {\n    return this.store?.getNotesInFile(filePath) || [];\n  }\n\n  /**\n   * Get backlinks for a note\n   */\n  getBacklinks(id: NoteId): Note[] {\n    return this.store?.getBacklinks(id) || [];\n  }\n\n  /**\n   * Search notes\n   */\n  search(query: string, limit: number = 20) {\n    return this.store?.search(query, limit) || [];\n  }\n\n  /**\n   * Add a new note\n   */\n  addNote(file: string, content: string, parentId?: NoteId): Note | null {\n    const note = this.store?.addNote(file, content, parentId);\n    if (note) {\n      this._onDidChange.fire();\n    }\n    return note || null;\n  }\n\n  /**\n   * Dispose resources\n   */\n  dispose(): void {\n    this.watcher?.dispose();\n    this.watcher = null;\n    this.store = null;\n    this.codemindPath = null;\n  }\n}\n\n// Singleton instance\nexport const extensionStore = new ExtensionStore();\n\n/**\n * Reference pattern for matching [[cm.xxx]] or [[cm.xxx|display]]\n */\nexport const NOTE_REFERENCE_PATTERN = /\\[\\[(cm\\.[a-z0-9]+)(?:\\|([^\\]]+))?\\]\\]/g;\n\n/**\n * Get the note reference at a position in the document\n */\nexport function getNoteReferenceAtPosition(\n  document: vscode.TextDocument,\n  position: vscode.Position\n): { id: NoteId; range: vscode.Range; displayText?: string } | null {\n  const line = document.lineAt(position.line);\n  const text = line.text;\n\n  // Find all references in the line\n  const pattern = new RegExp(NOTE_REFERENCE_PATTERN.source, 'g');\n  let match;\n\n  while ((match = pattern.exec(text)) !== null) {\n    const startCol = match.index;\n    const endCol = match.index + match[0].length;\n\n    if (position.character >= startCol && position.character <= endCol) {\n      const result: { id: NoteId; range: vscode.Range; displayText?: string } = {\n        id: match[1] as NoteId,\n        range: new vscode.Range(position.line, startCol, position.line, endCol),\n      };\n      if (match[2] !== undefined) {\n        result.displayText = match[2];\n      }\n      return result;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get the location of a note definition in codemind.md\n */\nexport async function getNoteDefinitionLocation(id: NoteId): Promise<vscode.Location | null> {\n  const codemindPath = extensionStore.getCodemindPath();\n  if (!codemindPath) return null;\n\n  const uri = vscode.Uri.file(codemindPath);\n  try {\n    const document = await vscode.workspace.openTextDocument(uri);\n    const text = document.getText();\n\n    // Search for the note definition line: - [[id]] or - [[id|display]] (with optional leading whitespace)\n    const pattern = new RegExp(`^\\\\s*-\\\\s*\\\\[\\\\[${id}(?:\\\\|[^\\\\]]+)?\\\\]\\\\]`, 'm');\n    const match = pattern.exec(text);\n\n    if (match) {\n      const pos = document.positionAt(match.index);\n      return new vscode.Location(uri, pos);\n    }\n  } catch {\n    // File not found\n  }\n\n  return null;\n}\n\n/**\n * Find all references to a note in the workspace\n */\nexport async function findNoteReferences(id: NoteId): Promise<vscode.Location[]> {\n  const locations: vscode.Location[] = [];\n  const pattern = new RegExp(`\\\\[\\\\[${id}(?:\\\\|[^\\\\]]+)?\\\\]\\\\]`, 'g');\n\n  // Search in all workspace files\n  const files = await vscode.workspace.findFiles('**/*.{md,ts,js,tsx,jsx}', '**/node_modules/**');\n\n  for (const file of files) {\n    try {\n      const document = await vscode.workspace.openTextDocument(file);\n      const text = document.getText();\n      let match;\n\n      while ((match = pattern.exec(text)) !== null) {\n        const pos = document.positionAt(match.index);\n        locations.push(new vscode.Location(file, pos));\n      }\n    } catch {\n      // Skip files that can't be opened\n    }\n  }\n\n  return locations;\n}\n\n/**\n * Get relative file path from workspace root\n */\nexport function getRelativeFilePath(filePath: string): string {\n  const workspaceFolder = vscode.workspace.workspaceFolders?.[0];\n  if (workspaceFolder) {\n    return path.relative(workspaceFolder.uri.fsPath, filePath);\n  }\n  return filePath;\n}\n", "// Parser module - \u4EBA\u985E\u53CB\u5584 MD \u89E3\u6790\u5668\n// Phase 1.2 v3 - \u652F\u63F4 Bullet + Indent \u683C\u5F0F\n\nimport type {\n  ParseResult,\n  Note,\n  NoteId,\n  NoteAuthor,\n  ProjectRoot,\n  ParseError,\n  ParseWarning,\n} from '../types/index.js';\n\n/**\n * Parser \u4ECB\u9762\n */\nexport interface Parser {\n  parse(content: string): ParseResult;\n  parseNoteBlock(lines: string[], startLine: number): Note | null;\n  extractReferences(content: string): NoteId[];\n}\n\n/**\n * \u6B63\u5247\u8868\u9054\u5F0F\u6A21\u5F0F\n */\nconst PATTERNS = {\n  // \u5C08\u6848\u6A19\u984C: # Code-Mind Notes\n  projectTitle: /^#\\s+Code-Mind\\s+Notes$/,\n  // \u5C08\u6848\u5143\u6578\u64DA\uFF08bullet \u683C\u5F0F\uFF09: - Project: xxx\n  projectName: /^-\\s*Project:\\s*(.+)$/,\n  projectCreated: /^-\\s*Created:\\s*(.+)$/,\n  // \u6A94\u6848\u5340\u584A\u6A19\u984C: - ## path/to/file.ts\n  fileSection: /^-\\s*##\\s+(.+)$/,\n  // \u7B46\u8A18\u6A19\u984C: - [[cm.xxx]] \u6458\u8981 \u6216 - [[cm.xxx]]\n  noteTitle: /^-\\s*\\[\\[(cm\\.[a-z0-9]+)\\]\\](?:\\s+(.*))?$/,\n  // \u5143\u6578\u64DA: - author \u00B7 date \u6216 - author \u00B7 date \u00B7 line X\n  noteMeta: /^-\\s*(\\w+)\\s*\u00B7\\s*(\\d{4}-\\d{2}-\\d{2})(?:\\s*\u00B7\\s*line\\s*(\\d+))?$/,\n  // \u7B46\u8A18\u5F15\u7528: [[cm.xxx]] \u6216 [[cm.xxx|display]]\n  noteRef: /\\[\\[(cm\\.[a-z0-9]+)(?:\\|([^\\]]+))?\\]\\]/g,\n  // \u5167\u5BB9\u884C: - \u5167\u5BB9\n  bulletLine: /^-\\s+(.*)$/,\n  // \u820A\u683C\u5F0F: - [[cm.xxx|...]]\uFF08\u5E36\u6709 display text\uFF09\n  oldNoteStart: /^-\\s*\\[\\[(cm\\.[a-z0-9]+)(?:\\|[^\\]]+)?\\]\\]$/,\n  // \u820A\u683C\u5F0F\u5C6C\u6027: key:: value\n  oldProperty: /^([a-z_]+)::\\s*(.*)$/,\n} as const;\n\n/**\n * \u63D0\u53D6\u7B46\u8A18\u5F15\u7528\n */\nfunction extractReferences(content: string): NoteId[] {\n  const refs: NoteId[] = [];\n  const regex = new RegExp(PATTERNS.noteRef.source, 'g');\n  let match;\n  while ((match = regex.exec(content)) !== null) {\n    const id = match[1] as NoteId;\n    if (!refs.includes(id)) {\n      refs.push(id);\n    }\n  }\n  return refs;\n}\n\n/**\n * \u8A08\u7B97\u884C\u7684\u7E2E\u6392\u5C64\u7D1A\uFF08\u4EE5 2 \u7A7A\u683C\u70BA\u55AE\u4F4D\uFF09\n */\nfunction getIndentLevel(line: string): number {\n  const match = line.match(/^(\\s*)/);\n  const spaces = match?.[1]?.length || 0;\n  return Math.floor(spaces / 2);\n}\n\n/**\n * \u89E3\u6790\u65B0\u683C\u5F0F\uFF08Bullet + Indent\uFF09\n */\nfunction parseNewFormat(lines: string[]): {\n  projectRoot: ProjectRoot | null;\n  notes: Note[];\n} {\n  let projectRoot: ProjectRoot | null = null;\n  const notes: Note[] = [];\n  let currentFile = '';\n  let i = 0;\n\n  // \u5C08\u6848\u8CC7\u8A0A\n  let projectName = 'Unnamed';\n  let projectCreated = new Date().toISOString().split('T')[0] || '';\n\n  while (i < lines.length) {\n    const line = lines[i] || '';\n    const trimmed = line.trim();\n    const indentLevel = getIndentLevel(line);\n\n    // \u8DF3\u904E\u7A7A\u884C\n    if (!trimmed) {\n      i++;\n      continue;\n    }\n\n    // \u5C08\u6848\u6A19\u984C\n    if (PATTERNS.projectTitle.test(trimmed)) {\n      i++;\n      continue;\n    }\n\n    // \u5C08\u6848\u540D\u7A31\n    const nameMatch = trimmed.match(PATTERNS.projectName);\n    if (nameMatch) {\n      projectName = nameMatch[1] || 'Unnamed';\n      i++;\n      continue;\n    }\n\n    // \u5C08\u6848\u5EFA\u7ACB\u65E5\u671F\n    const createdMatch = trimmed.match(PATTERNS.projectCreated);\n    if (createdMatch) {\n      projectCreated = createdMatch[1] || '';\n      projectRoot = {\n        id: 'project-root',\n        type: 'project',\n        name: projectName,\n        created: projectCreated,\n        projectNotes: [],\n        map: { collapsed: true, files: [] },\n      };\n      i++;\n      continue;\n    }\n\n    // \u6A94\u6848\u5340\u584A\u6A19\u984C: - ## path/to/file.ts\n    const fileMatch = trimmed.match(PATTERNS.fileSection);\n    if (fileMatch) {\n      currentFile = fileMatch[1] || '';\n      i++;\n      continue;\n    }\n\n    // \u7B46\u8A18\u6A19\u984C: - [[cm.xxx]] \u6458\u8981\n    const noteMatch = trimmed.match(PATTERNS.noteTitle);\n    if (noteMatch && indentLevel >= 1) {\n      const noteId = noteMatch[1] as NoteId;\n      const idHash = noteId.replace('cm.', '');\n\n      const note: Note = {\n        properties: {\n          id: noteId,\n          file: currentFile,\n          author: 'human',\n          created: new Date().toISOString().split('T')[0] || '',\n        },\n        content: [],\n        children: [],\n        displayPath: `${currentFile}/${idHash}`,\n      };\n\n      const noteIndent = indentLevel;\n      i++;\n\n      // \u89E3\u6790\u7B46\u8A18\u5167\u5BB9\uFF08\u66F4\u6DF1\u5C64\u7684 bullet\uFF09\n      while (i < lines.length) {\n        const contentLine = lines[i] || '';\n        const contentTrimmed = contentLine.trim();\n        const contentIndent = getIndentLevel(contentLine);\n\n        // \u7A7A\u884C\u8DF3\u904E\n        if (!contentTrimmed) {\n          i++;\n          continue;\n        }\n\n        // \u5982\u679C\u7E2E\u6392\u6BD4\u7B46\u8A18\u6DFA\u6216\u76F8\u540C\uFF0C\u7D50\u675F\u9019\u500B\u7B46\u8A18\n        if (contentIndent <= noteIndent) {\n          break;\n        }\n\n        // \u6AA2\u67E5\u662F\u5426\u70BA\u5143\u6578\u64DA\u884C\n        const metaMatch = contentTrimmed.match(PATTERNS.noteMeta);\n        if (metaMatch) {\n          note.properties.author = metaMatch[1] as NoteAuthor;\n          note.properties.created = metaMatch[2] || '';\n          if (metaMatch[3]) {\n            note.properties.line = parseInt(metaMatch[3], 10);\n          }\n          i++;\n          continue;\n        }\n\n        // \u6AA2\u67E5\u662F\u5426\u70BA\u5B50\u7B46\u8A18\n        const childMatch = contentTrimmed.match(PATTERNS.noteTitle);\n        if (childMatch && contentIndent === noteIndent + 1) {\n          const childId = childMatch[1] as NoteId;\n          const childHash = childId.replace('cm.', '');\n\n          const child: Note = {\n            properties: {\n              id: childId,\n              file: currentFile,\n              author: 'human',\n              created: new Date().toISOString().split('T')[0] || '',\n              parent: noteId,\n            },\n            content: [],\n            children: [],\n            displayPath: `${currentFile}/${idHash}/${childHash}`,\n          };\n\n          const childIndent = contentIndent;\n          i++;\n\n          // \u89E3\u6790\u5B50\u7B46\u8A18\u5167\u5BB9\n          while (i < lines.length) {\n            const childLine = lines[i] || '';\n            const childTrimmed = childLine.trim();\n            const childContentIndent = getIndentLevel(childLine);\n\n            if (!childTrimmed) {\n              i++;\n              continue;\n            }\n\n            if (childContentIndent <= childIndent) {\n              break;\n            }\n\n            // \u5B50\u7B46\u8A18\u5143\u6578\u64DA\n            const childMetaMatch = childTrimmed.match(PATTERNS.noteMeta);\n            if (childMetaMatch) {\n              child.properties.author = childMetaMatch[1] as NoteAuthor;\n              child.properties.created = childMetaMatch[2] || '';\n              if (childMetaMatch[3]) {\n                child.properties.line = parseInt(childMetaMatch[3], 10);\n              }\n              i++;\n              continue;\n            }\n\n            // \u5B50\u7B46\u8A18\u5167\u5BB9\n            const childBulletMatch = childTrimmed.match(PATTERNS.bulletLine);\n            if (childBulletMatch) {\n              const relativeIndent = childContentIndent - childIndent - 1;\n              child.content.push({\n                indent: Math.max(0, relativeIndent),\n                content: childBulletMatch[1] || '',\n                references: extractReferences(childBulletMatch[1] || ''),\n              });\n            }\n            i++;\n          }\n\n          note.children.push(child);\n          continue;\n        }\n\n        // \u666E\u901A\u5167\u5BB9\u884C\n        const bulletMatch = contentTrimmed.match(PATTERNS.bulletLine);\n        if (bulletMatch) {\n          const relativeIndent = contentIndent - noteIndent - 1;\n          note.content.push({\n            indent: Math.max(0, relativeIndent),\n            content: bulletMatch[1] || '',\n            references: extractReferences(bulletMatch[1] || ''),\n          });\n        }\n        i++;\n      }\n\n      notes.push(note);\n      continue;\n    }\n\n    i++;\n  }\n\n  // \u5982\u679C\u6C92\u6709\u89E3\u6790\u5230 projectRoot\uFF0C\u5EFA\u7ACB\u9810\u8A2D\u7684\n  if (!projectRoot) {\n    projectRoot = {\n      id: 'project-root',\n      type: 'project',\n      name: projectName,\n      created: projectCreated,\n      projectNotes: [],\n      map: { collapsed: true, files: [] },\n    };\n  }\n\n  return { projectRoot, notes };\n}\n\n/**\n * \u89E3\u6790\u820A\u683C\u5F0F\uFF08Logseq \u98A8\u683C\uFF09\n */\nfunction parseOldFormat(lines: string[]): {\n  projectRoot: ProjectRoot | null;\n  notes: Note[];\n} {\n  let projectRoot: ProjectRoot | null = null;\n  const notes: Note[] = [];\n  let i = 0;\n\n  // \u5C0B\u627E\u5C08\u6848\u6839\n  while (i < lines.length) {\n    const line = lines[i] || '';\n    if (line.includes('id:: project-root')) {\n      // \u89E3\u6790\u5C08\u6848\u8CC7\u8A0A\n      let name = 'Unnamed';\n      let created = new Date().toISOString().split('T')[0] || '';\n\n      // \u5F80\u5F8C\u627E\u5C6C\u6027\n      let j = i + 1;\n      while (j < lines.length && j < i + 10) {\n        const propLine = lines[j] || '';\n        const nameMatch = propLine.match(/name::\\s*(.+)/);\n        const createdMatch = propLine.match(/created::\\s*(.+)/);\n        if (nameMatch) name = nameMatch[1] || name;\n        if (createdMatch) created = createdMatch[1] || created;\n        j++;\n      }\n\n      projectRoot = {\n        id: 'project-root',\n        type: 'project',\n        name,\n        created,\n        projectNotes: [],\n        map: { collapsed: true, files: [] },\n      };\n      break;\n    }\n    i++;\n  }\n\n  // \u89E3\u6790\u7B46\u8A18\u5340\u584A\n  i = 0;\n  while (i < lines.length) {\n    const line = lines[i] || '';\n    const noteMatch = line.match(PATTERNS.oldNoteStart);\n\n    if (noteMatch) {\n      const noteId = noteMatch[1] as NoteId;\n      const idHash = noteId.replace('cm.', '');\n\n      const note: Note = {\n        properties: {\n          id: noteId,\n          author: 'human',\n          created: new Date().toISOString().split('T')[0] || '',\n        },\n        content: [],\n        children: [],\n        displayPath: '',\n      };\n\n      i++;\n\n      // \u89E3\u6790\u5C6C\u6027\n      while (i < lines.length) {\n        const propLine = lines[i] || '';\n        const trimmedProp = propLine.trim();\n\n        // \u6AA2\u67E5\u662F\u5426\u70BA\u5167\u5BB9\u884C\uFF08\u4EE5 - \u958B\u982D\uFF09\n        if (trimmedProp.startsWith('- ')) {\n          break;\n        }\n\n        // \u6AA2\u67E5\u662F\u5426\u70BA\u4E0B\u4E00\u500B\u7B46\u8A18\u5340\u584A\n        if (propLine.match(PATTERNS.oldNoteStart)) {\n          break;\n        }\n\n        // \u5617\u8A66\u5339\u914D\u5C6C\u6027\uFF08trim \u5F8C\u518D\u5339\u914D\uFF09\n        const propMatch = trimmedProp.match(PATTERNS.oldProperty);\n\n        if (!propMatch) {\n          i++;\n          continue;\n        }\n\n        const key = propMatch[1];\n        const value = propMatch[2] || '';\n        switch (key) {\n          case 'id':\n            // \u5DF2\u6709 ID\n            break;\n          case 'file':\n            note.properties.file = value;\n            break;\n          case 'line':\n            note.properties.line = parseInt(value || '0', 10);\n            break;\n          case 'author':\n            note.properties.author = (value as NoteAuthor) || 'human';\n            break;\n          case 'created':\n            note.properties.created = value || '';\n            break;\n          case 'parent':\n            note.properties.parent = value as NoteId;\n            break;\n        }\n        i++;\n      }\n\n      // \u89E3\u6790\u5167\u5BB9\n      while (i < lines.length) {\n        const contentLine = lines[i] || '';\n        if (contentLine.match(PATTERNS.oldNoteStart)) {\n          break;\n        }\n\n        const bulletMatch = contentLine.match(/^(\\s*)- (.*)$/);\n        if (bulletMatch) {\n          const indent = Math.floor((bulletMatch[1]?.length || 0) / 2) - 1;\n          const content = bulletMatch[2] || '';\n          if (indent >= 0) {\n            note.content.push({\n              indent,\n              content,\n              references: extractReferences(content),\n            });\n          }\n        }\n        i++;\n      }\n\n      // \u8A2D\u7F6E\u986F\u793A\u8DEF\u5F91\n      const file = note.properties.file || 'unknown';\n      note.displayPath = note.properties.parent\n        ? `${file}/${note.properties.parent.replace('cm.', '')}/${idHash}`\n        : `${file}/${idHash}`;\n\n      notes.push(note);\n      continue;\n    }\n\n    i++;\n  }\n\n  return { projectRoot, notes };\n}\n\n/**\n * \u6AA2\u6E2C\u683C\u5F0F\u985E\u578B\n */\nfunction detectFormat(content: string): 'new' | 'old' {\n  // \u65B0\u683C\u5F0F\u7279\u5FB5: - ## (\u6A94\u6848\u5340\u584A) \u6216 - [[cm.xxx]] (\u7B46\u8A18)\n  if (content.includes('- ## ') || /^\\s*- \\[\\[cm\\./m.test(content)) {\n    // \u78BA\u8A8D\u4E0D\u662F\u820A\u683C\u5F0F\n    if (!content.includes('id:: cm.')) {\n      return 'new';\n    }\n  }\n  // \u820A\u683C\u5F0F\u7279\u5FB5: id:: cm. \u5C6C\u6027\n  if (content.includes('id:: cm.')) {\n    return 'old';\n  }\n  return 'new'; // \u9810\u8A2D\u4F7F\u7528\u65B0\u683C\u5F0F\n}\n\n/**\n * \u5EFA\u7ACB\u6B63\u5411\u9023\u7D50\u5716\n */\nfunction buildForwardLinks(notes: Map<NoteId, Note>): Map<NoteId, NoteId[]> {\n  const forwardLinks = new Map<NoteId, NoteId[]>();\n\n  for (const [id, note] of notes) {\n    const refs: NoteId[] = [];\n\n    // \u5F9E related \u5C6C\u6027\u6536\u96C6\n    if (note.properties.related) {\n      refs.push(...note.properties.related);\n    }\n\n    // \u5F9E\u5167\u5BB9\u4E2D\u6536\u96C6\n    for (const line of note.content) {\n      if (line.references) {\n        for (const ref of line.references) {\n          if (!refs.includes(ref)) {\n            refs.push(ref);\n          }\n        }\n      }\n    }\n\n    forwardLinks.set(id, refs);\n  }\n\n  return forwardLinks;\n}\n\n/**\n * \u5EFA\u7ACB\u53CD\u5411\u9023\u7D50\u5716\n */\nfunction buildBackwardLinks(forwardLinks: Map<NoteId, NoteId[]>): Map<NoteId, NoteId[]> {\n  const backwardLinks = new Map<NoteId, NoteId[]>();\n\n  for (const [fromId, toIds] of forwardLinks) {\n    for (const toId of toIds) {\n      const existing = backwardLinks.get(toId) || [];\n      if (!existing.includes(fromId)) {\n        existing.push(fromId);\n      }\n      backwardLinks.set(toId, existing);\n    }\n  }\n\n  return backwardLinks;\n}\n\n/**\n * \u6536\u96C6\u6240\u6709\u7B46\u8A18\uFF08\u5305\u542B\u5B50\u7B46\u8A18\uFF09\u5230 Map\n */\nfunction collectNotes(notes: Note[], target: Map<NoteId, Note>): void {\n  for (const note of notes) {\n    target.set(note.properties.id, note);\n    if (note.children.length > 0) {\n      collectNotes(note.children, target);\n    }\n  }\n}\n\n/**\n * \u6AA2\u67E5\u91CD\u8907 ID\n */\nfunction checkDuplicateIds(\n  notes: Note[],\n  seen: Set<NoteId>,\n  errors: ParseError[]\n): void {\n  for (const note of notes) {\n    if (seen.has(note.properties.id)) {\n      errors.push({\n        type: 'duplicate_id',\n        line: 0,\n        message: `Duplicate note ID: ${note.properties.id}`,\n      });\n    }\n    seen.add(note.properties.id);\n    checkDuplicateIds(note.children, seen, errors);\n  }\n}\n\n/**\n * \u6AA2\u67E5\u5B64\u7ACB\u5F15\u7528\n */\nfunction checkOrphanReferences(\n  notes: Map<NoteId, Note>,\n  forwardLinks: Map<NoteId, NoteId[]>,\n  warnings: ParseWarning[]\n): void {\n  for (const [fromId, toIds] of forwardLinks) {\n    for (const toId of toIds) {\n      if (!notes.has(toId)) {\n        warnings.push({\n          type: 'orphan_reference',\n          line: 0,\n          message: `Note ${fromId} references non-existent note ${toId}`,\n        });\n      }\n    }\n  }\n}\n\n/**\n * \u4E3B\u89E3\u6790\u51FD\u6578\n */\nfunction parse(content: string): ParseResult {\n  const errors: ParseError[] = [];\n  const warnings: ParseWarning[] = [];\n\n  // \u6AA2\u6E2C\u683C\u5F0F\n  const format = detectFormat(content);\n  const lines = content.split('\\n');\n\n  // \u89E3\u6790\n  const { projectRoot, notes } =\n    format === 'new' ? parseNewFormat(lines) : parseOldFormat(lines);\n\n  // \u6536\u96C6\u6240\u6709\u7B46\u8A18\u5230 Map\n  const notesMap = new Map<NoteId, Note>();\n  collectNotes(notes, notesMap);\n\n  // \u6AA2\u67E5\u91CD\u8907 ID\n  const seenIds = new Set<NoteId>();\n  checkDuplicateIds(notes, seenIds, errors);\n\n  // \u5EFA\u7ACB\u9023\u7D50\u5716\n  const forwardLinks = buildForwardLinks(notesMap);\n  const backwardLinks = buildBackwardLinks(forwardLinks);\n\n  // \u6AA2\u67E5\u5B64\u7ACB\u5F15\u7528\n  checkOrphanReferences(notesMap, forwardLinks, warnings);\n\n  return {\n    projectRoot,\n    notes: notesMap,\n    forwardLinks,\n    backwardLinks,\n    errors,\n    warnings,\n  };\n}\n\n/**\n * \u89E3\u6790\u55AE\u4E00\u7B46\u8A18\u5340\u584A\uFF08\u7528\u65BC\u6E2C\u8A66\uFF09\n */\nfunction parseNoteBlock(lines: string[], _startLine: number): Note | null {\n  const content = lines.join('\\n');\n  const result = parse(content);\n  const notes = [...result.notes.values()];\n  return notes[0] || null;\n}\n\n/**\n * \u5EFA\u7ACB Parser \u5BE6\u4F8B\n */\nexport function createParser(): Parser {\n  return {\n    parse,\n    parseNoteBlock,\n    extractReferences,\n  };\n}\n\n// \u5C0E\u51FA\u8F14\u52A9\u51FD\u6578\u4F9B\u6E2C\u8A66\u4F7F\u7528\nexport { extractReferences, detectFormat, parseNewFormat, parseOldFormat };\n\n// \u517C\u5BB9\u820A\u7684\u5C0E\u51FA\nexport function parseLine(line: string, lineNumber: number) {\n  return {\n    lineNumber,\n    indent: 0,\n    content: line,\n    isBullet: line.trim().startsWith('- '),\n    raw: line,\n  };\n}\n\nexport function parseProperty(content: string): { key: string; value: string } | null {\n  const match = content.match(PATTERNS.oldProperty);\n  if (match) {\n    return { key: match[1] || '', value: match[2] || '' };\n  }\n  return null;\n}\n\nexport function isNoteBlockStart(content: string): NoteId | null {\n  const match = content.match(/\\[\\[(cm\\.[a-z0-9]+)(?:\\|[^\\]]+)?\\]\\]/);\n  return match ? (match[1] as NoteId) : null;\n}\n", "// Writer module - \u4EBA\u985E\u53CB\u5584 MD \u5BEB\u5165\u5668\n// Phase 1.3 v3 - Bullet + Indent \u683C\u5F0F\n\nimport type { ProjectRoot, Note, NoteLine, NoteProperties } from '../types/index.js';\n\n/**\n * \u5BEB\u5165\u9078\u9805\n */\nexport interface WriteOptions {\n  preserveFormatting?: boolean;\n  sortNotes?: boolean;\n}\n\n/**\n * Writer \u4ECB\u9762\n */\nexport interface Writer {\n  write(projectRoot: ProjectRoot | null, notes: Note[], options?: WriteOptions): string;\n  serializeNote(note: Note, indent: number): string;\n  generateMap(notes: Note[]): string;\n}\n\n/**\n * \u6309\u6A94\u6848\u5206\u7D44\u7B46\u8A18\n */\nfunction groupNotesByFile(notes: Note[]): Map<string, Note[]> {\n  const grouped = new Map<string, Note[]>();\n\n  for (const note of notes) {\n    const file = note.properties.file || 'unknown';\n    const existing = grouped.get(file) || [];\n    existing.push(note);\n    grouped.set(file, existing);\n  }\n\n  return grouped;\n}\n\n/**\n * \u53D6\u5F97\u7B46\u8A18\u6458\u8981\uFF08\u7B2C\u4E00\u884C\u5167\u5BB9\uFF0C\u622A\u65B7\uFF09\n */\nfunction getSummary(note: Note, maxLength: number = 50): string {\n  if (note.content.length === 0) {\n    return '';\n  }\n  const firstLine = note.content[0]?.content || '';\n  if (firstLine.length <= maxLength) {\n    return firstLine;\n  }\n  return firstLine.slice(0, maxLength - 3) + '...';\n}\n\n/**\n * \u683C\u5F0F\u5316\u5143\u6578\u64DA\u884C\uFF08bullet \u683C\u5F0F\uFF09\n * \u683C\u5F0F: - author \u00B7 date \u00B7 line X\n */\nfunction formatMetadata(props: NoteProperties): string {\n  const parts: string[] = [];\n  parts.push(props.author);\n  parts.push(props.created);\n  if (props.line !== undefined) {\n    parts.push(`line ${props.line}`);\n  }\n  return parts.join(' \u00B7 ');\n}\n\n/**\n * \u7522\u751F\u7E2E\u6392\u5B57\u4E32\n */\nfunction indent(level: number): string {\n  return '  '.repeat(level);\n}\n\n/**\n * \u5E8F\u5217\u5316\u7B46\u8A18\u5167\u5BB9\uFF08bullet \u683C\u5F0F\uFF09\n */\nfunction serializeContent(content: NoteLine[], baseIndent: number): string[] {\n  const lines: string[] = [];\n  for (const line of content) {\n    const totalIndent = baseIndent + line.indent;\n    lines.push(`${indent(totalIndent)}- ${line.content}`);\n  }\n  return lines;\n}\n\n/**\n * \u5E8F\u5217\u5316\u55AE\u4E00\u7B46\u8A18\uFF08bullet + indent \u683C\u5F0F\uFF09\n */\nfunction serializeNote(note: Note, baseIndent: number = 1): string {\n  const lines: string[] = [];\n\n  // \u7B46\u8A18\u6A19\u984C: - [[cm.xxx]] \u6458\u8981\n  const summary = getSummary(note);\n  const titleSuffix = summary ? ` ${summary}` : '';\n  lines.push(`${indent(baseIndent)}- [[${note.properties.id}]]${titleSuffix}`);\n\n  // \u5143\u6578\u64DA: - author \u00B7 date \u00B7 line\n  lines.push(`${indent(baseIndent + 1)}- ${formatMetadata(note.properties)}`);\n\n  // \u5167\u5BB9\n  const contentLines = serializeContent(note.content, baseIndent + 1);\n  lines.push(...contentLines);\n\n  // \u5B50\u7B46\u8A18\n  if (note.children.length > 0) {\n    for (const child of note.children) {\n      const childSummary = getSummary(child);\n      const childTitleSuffix = childSummary ? ` ${childSummary}` : '';\n      lines.push(`${indent(baseIndent + 1)}- [[${child.properties.id}]]${childTitleSuffix}`);\n      lines.push(`${indent(baseIndent + 2)}- ${formatMetadata(child.properties)}`);\n      const childContentLines = serializeContent(child.content, baseIndent + 2);\n      lines.push(...childContentLines);\n    }\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * \u7522\u751F Map \u5340\u584A\uFF08\u4FDD\u7559\u517C\u5BB9\u6027\uFF0C\u4F46\u7C21\u5316\uFF09\n */\nfunction generateMap(_notes: Note[]): string {\n  // \u65B0\u683C\u5F0F\u4E0D\u9700\u8981 Map\uFF0C\u8FD4\u56DE\u7A7A\u5B57\u4E32\n  return '';\n}\n\n/**\n * \u5E8F\u5217\u5316\u5C08\u6848\u982D\u90E8\uFF08bullet \u683C\u5F0F\uFF09\n */\nfunction serializeProjectHeader(projectRoot: ProjectRoot): string {\n  const lines: string[] = [];\n\n  lines.push('# Code-Mind Notes');\n  lines.push(`- Project: ${projectRoot.name}`);\n  lines.push(`- Created: ${projectRoot.created}`);\n\n  // \u5C08\u6848\u5C64\u7D1A\u7B46\u8A18\n  if (projectRoot.projectNotes.length > 0) {\n    lines.push('');\n    lines.push('- Project Notes');\n    for (const line of projectRoot.projectNotes) {\n      const totalIndent = 1 + line.indent;\n      lines.push(`${indent(totalIndent)}- ${line.content}`);\n    }\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * \u4E3B\u5BEB\u5165\u51FD\u6578\uFF08bullet + indent \u683C\u5F0F\uFF09\n */\nfunction write(projectRoot: ProjectRoot | null, notes: Note[], options: WriteOptions = {}): string {\n  const { sortNotes = true } = options;\n\n  // \u904E\u6FFE\u51FA\u9802\u5C64\u7B46\u8A18\n  const topLevelNotes = notes.filter(n => !n.properties.parent);\n\n  // \u6392\u5E8F\u7B46\u8A18\n  const sortedNotes = [...topLevelNotes];\n  if (sortNotes) {\n    sortedNotes.sort((a, b) => {\n      // \u5148\u6309\u6A94\u6848\u6392\u5E8F\n      const fileA = a.properties.file || 'unknown';\n      const fileB = b.properties.file || 'unknown';\n      if (fileA !== fileB) {\n        return fileA.localeCompare(fileB);\n      }\n      // \u540C\u6A94\u6848\u6309 ID \u6392\u5E8F\n      return a.properties.id.localeCompare(b.properties.id);\n    });\n  }\n\n  const lines: string[] = [];\n\n  // \u5C08\u6848\u982D\u90E8\n  if (projectRoot) {\n    lines.push(serializeProjectHeader(projectRoot));\n  } else {\n    lines.push('# Code-Mind Notes');\n  }\n\n  // \u6309\u6A94\u6848\u5206\u7D44\u8F38\u51FA\n  const grouped = groupNotesByFile(sortedNotes);\n  const sortedFiles = [...grouped.keys()].sort();\n\n  for (const file of sortedFiles) {\n    const fileNotes = grouped.get(file) || [];\n\n    // \u6A94\u6848\u6A19\u984C\n    lines.push('');\n    lines.push(`- ## ${file}`);\n\n    // \u8A72\u6A94\u6848\u7684\u7B46\u8A18\n    for (const note of fileNotes) {\n      lines.push(serializeNote(note, 1));\n    }\n  }\n\n  return lines.join('\\n').trim() + '\\n';\n}\n\n/**\n * \u5EFA\u7ACB Writer \u5BE6\u4F8B\n */\nexport function createWriter(): Writer {\n  return {\n    write,\n    serializeNote,\n    generateMap,\n  };\n}\n\n// \u5C0E\u51FA\u8F14\u52A9\u51FD\u6578\u4F9B\u6E2C\u8A66\u4F7F\u7528\nexport {\n  serializeContent,\n  serializeNote,\n  serializeProjectHeader,\n  generateMap,\n  groupNotesByFile,\n  getSummary,\n  formatMetadata,\n};\n\n// \u4FDD\u7559\u820A\u7684\u5C0E\u51FA\u540D\u7A31\u4EE5\u4FDD\u6301\u517C\u5BB9\u6027\nexport const serializeProperties = formatMetadata;\nexport const serializeProjectRoot = serializeProjectHeader;\n", "// NoteStore module - \u8CC7\u6599\u5B58\u53D6\u5C64\n// Phase 1.5 \u5BE6\u4F5C\n\nimport * as fs from 'fs';\nimport type {\n  Note,\n  NoteId,\n  NotePath,\n  NoteProperties,\n  NoteLine,\n  RelatedNote,\n  SearchResult,\n  SearchMatch,\n  ProjectRoot,\n  ParseResult,\n} from '../types/index.js';\nimport { createParser } from '../parser/index.js';\nimport { createWriter } from '../writer/index.js';\nimport { createBacklinkManager, type BacklinkManager } from '../linker/index.js';\n\n/**\n * NoteStore \u4ECB\u9762\n */\nexport interface NoteStore {\n  // \u67E5\u8A62\n  getNote(id: NoteId): Note | null;\n  getNoteByPath(path: NotePath): Note | null;\n  getAllNotes(): Note[];\n  getNotesInFile(file: string): Note[];\n  getChildren(parentId: NoteId): Note[];\n\n  // \u9023\u7D50\u67E5\u8A62\n  getBacklinks(id: NoteId): Note[];\n  getRelated(id: NoteId, depth?: number): RelatedNote[];\n  getOrphans(): Note[];\n  getPopular(limit?: number): Note[];\n\n  // \u641C\u5C0B\n  search(query: string, limit?: number): SearchResult[];\n\n  // \u4FEE\u6539\n  addNote(file: string, content: string, parentId?: NoteId, noteId?: NoteId): Note;\n  updateNote(id: NoteId, content: string): Note;\n  deleteNote(id: NoteId): void;\n  moveNote(id: NoteId, newFile: string, newLine?: number): Note;\n\n  // \u540C\u6B65\n  reload(): void;\n  save(): void;\n\n  // \u5B58\u53D6\u5167\u90E8\u72C0\u614B (\u4F9B\u6E2C\u8A66\u548C\u9032\u968E\u7528\u9014)\n  getProjectRoot(): ProjectRoot | null;\n  getParseResult(): ParseResult | null;\n}\n\n/**\n * NoteStore \u9078\u9805\n */\nexport interface NoteStoreOptions {\n  /** ID \u7522\u751F\u5668 (\u53EF\u9078\uFF0C\u9810\u8A2D\u4F7F\u7528\u5167\u5EFA) */\n  generateId?: () => NoteId;\n  /** \u662F\u5426\u81EA\u52D5\u5132\u5B58 (\u9810\u8A2D: true) */\n  autoSave?: boolean;\n}\n\n/**\n * \u9810\u8A2D ID \u7522\u751F\u5668 (\u7C21\u55AE\u7248\u672C\uFF0C\u5F8C\u7E8C Phase 1.6 \u6703\u6539\u9032)\n */\nfunction defaultGenerateId(): NoteId {\n  const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';\n  let hash = '';\n  for (let i = 0; i < 6; i++) {\n    hash += chars[Math.floor(Math.random() * chars.length)];\n  }\n  return `cm.${hash}` as NoteId;\n}\n\n/**\n * \u5EFA\u7ACB NoteStore \u5BE6\u4F8B\n */\nexport function createNoteStore(codemindPath: string, options: NoteStoreOptions = {}): NoteStore {\n  const { generateId = defaultGenerateId, autoSave = true } = options;\n\n  // \u5167\u90E8\u72C0\u614B\n  let projectRoot: ProjectRoot | null = null;\n  let notesMap: Map<NoteId, Note> = new Map();\n  let parseResult: ParseResult | null = null;\n  let backlinkManager: BacklinkManager = createBacklinkManager();\n  let isDirty = false;\n\n  // \u5DE5\u5177\n  const parser = createParser();\n  const writer = createWriter();\n\n  /**\n   * \u5F9E\u6A94\u6848\u8F09\u5165\n   */\n  function load(): void {\n    if (!fs.existsSync(codemindPath)) {\n      // \u6A94\u6848\u4E0D\u5B58\u5728\uFF0C\u521D\u59CB\u5316\u7A7A\u72C0\u614B\n      projectRoot = null;\n      notesMap = new Map();\n      parseResult = null;\n      backlinkManager = createBacklinkManager();\n      return;\n    }\n\n    const content = fs.readFileSync(codemindPath, 'utf-8');\n    parseResult = parser.parse(content);\n    projectRoot = parseResult.projectRoot;\n    notesMap = parseResult.notes;\n\n    // \u91CD\u5EFA backlinks\n    const allNotes = getAllNotesInternal();\n    backlinkManager.rebuildAll(allNotes);\n  }\n\n  /**\n   * \u53D6\u5F97\u6240\u6709\u7B46\u8A18 (\u5167\u90E8\u4F7F\u7528\uFF0C\u542B\u5B50\u7B46\u8A18)\n   */\n  function getAllNotesInternal(): Note[] {\n    const all: Note[] = [];\n    function collect(notes: Note[]) {\n      for (const note of notes) {\n        all.push(note);\n        if (note.children.length > 0) {\n          collect(note.children);\n        }\n      }\n    }\n    collect(Array.from(notesMap.values()).filter(n => !n.properties.parent));\n    return all;\n  }\n\n  /**\n   * \u53D6\u5F97\u9802\u5C64\u7B46\u8A18\n   */\n  function getTopLevelNotes(): Note[] {\n    return Array.from(notesMap.values()).filter(n => !n.properties.parent);\n  }\n\n  /**\n   * \u5132\u5B58\u5230\u6A94\u6848\n   */\n  function saveToFile(): void {\n    const topLevelNotes = getTopLevelNotes();\n    const content = writer.write(projectRoot, topLevelNotes);\n\n    // Atomic write\n    const tempPath = codemindPath + '.tmp';\n    fs.writeFileSync(tempPath, content, 'utf-8');\n    fs.renameSync(tempPath, codemindPath);\n    isDirty = false;\n  }\n\n  /**\n   * \u6A19\u8A18\u70BA\u5DF2\u4FEE\u6539\n   */\n  function markDirty(): void {\n    isDirty = true;\n    if (autoSave) {\n      saveToFile();\n    }\n  }\n\n  /**\n   * \u5EFA\u7ACB\u986F\u793A\u8DEF\u5F91\n   */\n  function buildDisplayPath(file: string, id: NoteId, parentId?: NoteId): NotePath {\n    const idHash = id.replace('cm.', '');\n    if (parentId) {\n      const parentHash = parentId.replace('cm.', '');\n      return `${file}/${parentHash}/${idHash}`;\n    }\n    return `${file}/${idHash}`;\n  }\n\n  /**\n   * \u66F4\u65B0 backlink \u8A08\u6578\n   */\n  function updateBacklinkCounts(): void {\n    for (const [id, note] of notesMap) {\n      const count = backlinkManager.getBacklinkCount(id);\n      if (count > 0) {\n        note.properties.backlink_count = count;\n        note.properties.backlinks = backlinkManager.getBackwardLinks(id);\n      } else {\n        delete note.properties.backlink_count;\n        delete note.properties.backlinks;\n      }\n    }\n  }\n\n  // \u521D\u59CB\u8F09\u5165\n  load();\n\n  // \u5BE6\u4F5C NoteStore \u4ECB\u9762\n  return {\n    // === \u67E5\u8A62 ===\n\n    getNote(id: NoteId): Note | null {\n      return notesMap.get(id) || null;\n    },\n\n    getNoteByPath(notePath: NotePath): Note | null {\n      for (const note of notesMap.values()) {\n        if (note.displayPath === notePath) {\n          return note;\n        }\n      }\n      return null;\n    },\n\n    getAllNotes(): Note[] {\n      return Array.from(notesMap.values());\n    },\n\n    getNotesInFile(file: string): Note[] {\n      return Array.from(notesMap.values()).filter(n => n.properties.file === file);\n    },\n\n    getChildren(parentId: NoteId): Note[] {\n      const parent = notesMap.get(parentId);\n      return parent ? parent.children : [];\n    },\n\n    // === \u9023\u7D50\u67E5\u8A62 ===\n\n    getBacklinks(id: NoteId): Note[] {\n      const backlinkIds = backlinkManager.getBackwardLinks(id);\n      return backlinkIds.map(bid => notesMap.get(bid)).filter((n): n is Note => n !== undefined);\n    },\n\n    getRelated(id: NoteId, depth: number = 1): RelatedNote[] {\n      const result: RelatedNote[] = [];\n      const visited = new Set<NoteId>([id]);\n\n      function traverse(\n        currentId: NoteId,\n        currentDepth: number,\n        direction: 'outgoing' | 'incoming'\n      ) {\n        if (currentDepth > depth) return;\n\n        const links =\n          direction === 'outgoing'\n            ? backlinkManager.getForwardLinks(currentId)\n            : backlinkManager.getBackwardLinks(currentId);\n\n        for (const linkedId of links) {\n          if (visited.has(linkedId)) continue;\n          visited.add(linkedId);\n\n          const note = notesMap.get(linkedId);\n          if (note) {\n            result.push({ note, direction, depth: currentDepth });\n            traverse(linkedId, currentDepth + 1, direction);\n          }\n        }\n      }\n\n      traverse(id, 1, 'outgoing');\n      traverse(id, 1, 'incoming');\n\n      return result;\n    },\n\n    getOrphans(): Note[] {\n      return Array.from(notesMap.values()).filter(note => {\n        const id = note.properties.id;\n        const hasBacklinks = backlinkManager.getBacklinkCount(id) > 0;\n        const hasForwardLinks = backlinkManager.getForwardLinks(id).length > 0;\n        return !hasBacklinks && !hasForwardLinks && !note.properties.parent;\n      });\n    },\n\n    getPopular(limit: number = 10): Note[] {\n      const notesWithCounts = Array.from(notesMap.values())\n        .map(note => ({\n          note,\n          count: backlinkManager.getBacklinkCount(note.properties.id),\n        }))\n        .filter(item => item.count > 0)\n        .sort((a, b) => b.count - a.count);\n\n      return notesWithCounts.slice(0, limit).map(item => item.note);\n    },\n\n    // === \u641C\u5C0B ===\n\n    search(query: string, limit: number = 20): SearchResult[] {\n      const results: SearchResult[] = [];\n      const queryLower = query.toLowerCase();\n      const queryTerms = queryLower.split(/\\s+/).filter(t => t.length > 0);\n\n      for (const note of notesMap.values()) {\n        const matches: SearchMatch[] = [];\n        let score = 0;\n\n        // \u641C\u5C0B\u5167\u5BB9\n        note.content.forEach((line, lineIdx) => {\n          const contentLower = line.content.toLowerCase();\n\n          for (const term of queryTerms) {\n            const idx = contentLower.indexOf(term);\n            if (idx !== -1) {\n              matches.push({\n                line: lineIdx,\n                content: line.content,\n                highlight: [idx, idx + term.length],\n              });\n              score += 1;\n\n              // \u5B8C\u5168\u5339\u914D\u52A0\u5206\n              if (contentLower === term) {\n                score += 2;\n              }\n            }\n          }\n        });\n\n        let hasPathMatch = false;\n\n        // \u641C\u5C0B\u6A94\u6848\u8DEF\u5F91\n        if (note.properties.file) {\n          const fileLower = note.properties.file.toLowerCase();\n          for (const term of queryTerms) {\n            if (fileLower.includes(term)) {\n              score += 0.5;\n              hasPathMatch = true;\n            }\n          }\n        }\n\n        // \u641C\u5C0B displayPath\n        const pathLower = note.displayPath.toLowerCase();\n        for (const term of queryTerms) {\n          if (pathLower.includes(term)) {\n            score += 0.5;\n            hasPathMatch = true;\n          }\n        }\n\n        // backlink \u6B21\u6578\u52A0\u5206 (\u53EA\u6709\u7576\u6709\u5176\u4ED6\u5339\u914D\u6642)\n        if (matches.length > 0 || hasPathMatch) {\n          score += backlinkManager.getBacklinkCount(note.properties.id) * 0.1;\n        }\n\n        if (matches.length > 0 || hasPathMatch) {\n          results.push({ note, matches, score });\n        }\n      }\n\n      // \u6309\u5206\u6578\u6392\u5E8F\n      results.sort((a, b) => b.score - a.score);\n\n      return results.slice(0, limit);\n    },\n\n    // === \u4FEE\u6539 ===\n\n    addNote(file: string, content: string, parentId?: NoteId, noteId?: NoteId): Note {\n      // \u4F7F\u7528\u63D0\u4F9B\u7684 ID \u6216\u7522\u751F\u65B0 ID (\u78BA\u4FDD\u552F\u4E00)\n      let newId: NoteId;\n      if (noteId && !notesMap.has(noteId)) {\n        newId = noteId;\n      } else {\n        do {\n          newId = generateId();\n        } while (notesMap.has(newId));\n      }\n\n      // \u5EFA\u7ACB\u7B46\u8A18\u5C6C\u6027\n      const properties: NoteProperties = {\n        id: newId,\n        file,\n        author: 'human',\n        created: new Date().toISOString().split('T')[0] || '',\n      };\n\n      if (parentId) {\n        properties.parent = parentId;\n      }\n\n      // \u5EFA\u7ACB\u7B46\u8A18\u5167\u5BB9\n      const contentLines: NoteLine[] = content.split('\\n').map(line => ({\n        indent: 0,\n        content: line,\n      }));\n\n      // \u5EFA\u7ACB\u7B46\u8A18\n      const displayPath = buildDisplayPath(file, newId, parentId);\n      const newNote: Note = {\n        properties,\n        content: contentLines,\n        children: [],\n        displayPath,\n      };\n\n      // \u52A0\u5165 Map\n      notesMap.set(newId, newNote);\n\n      // \u5982\u679C\u6709\u7236\u7B46\u8A18\uFF0C\u52A0\u5165\u7236\u7B46\u8A18\u7684 children\n      if (parentId) {\n        const parent = notesMap.get(parentId);\n        if (parent) {\n          parent.children.push(newNote);\n        }\n      }\n\n      // \u66F4\u65B0 backlinks\n      backlinkManager.updateForNote(newNote, '', content);\n      updateBacklinkCounts();\n\n      markDirty();\n      return newNote;\n    },\n\n    updateNote(id: NoteId, content: string): Note {\n      const note = notesMap.get(id);\n      if (!note) {\n        throw new Error(`Note not found: ${id}`);\n      }\n\n      // \u5132\u5B58\u820A\u5167\u5BB9\n      const oldContent = note.content.map(l => l.content).join('\\n');\n\n      // \u66F4\u65B0\u5167\u5BB9\n      const contentLines: NoteLine[] = content.split('\\n').map(line => ({\n        indent: 0,\n        content: line,\n      }));\n      note.content = contentLines;\n\n      // \u66F4\u65B0 backlinks\n      backlinkManager.updateForNote(note, oldContent, content);\n      updateBacklinkCounts();\n\n      markDirty();\n      return note;\n    },\n\n    deleteNote(id: NoteId): void {\n      const note = notesMap.get(id);\n      if (!note) {\n        throw new Error(`Note not found: ${id}`);\n      }\n\n      // \u5148\u522A\u9664\u6240\u6709\u5B50\u7B46\u8A18\n      for (const child of note.children) {\n        this.deleteNote(child.properties.id);\n      }\n\n      // \u5F9E\u7236\u7B46\u8A18\u4E2D\u79FB\u9664\n      if (note.properties.parent) {\n        const parent = notesMap.get(note.properties.parent);\n        if (parent) {\n          parent.children = parent.children.filter(c => c.properties.id !== id);\n        }\n      }\n\n      // \u5F9E backlink manager \u79FB\u9664\n      backlinkManager.removeNote(id);\n\n      // \u5F9E Map \u79FB\u9664\n      notesMap.delete(id);\n\n      updateBacklinkCounts();\n      markDirty();\n    },\n\n    moveNote(id: NoteId, newFile: string, newLine?: number): Note {\n      const note = notesMap.get(id);\n      if (!note) {\n        throw new Error(`Note not found: ${id}`);\n      }\n\n      // \u66F4\u65B0\u5C6C\u6027\n      note.properties.file = newFile;\n      if (newLine !== undefined) {\n        note.properties.line = newLine;\n      }\n\n      // \u66F4\u65B0 displayPath\n      note.displayPath = buildDisplayPath(newFile, id, note.properties.parent);\n\n      // \u905E\u8FF4\u66F4\u65B0\u5B50\u7B46\u8A18\u7684 displayPath\n      function updateChildrenPath(parentNote: Note) {\n        for (const child of parentNote.children) {\n          child.properties.file = newFile;\n          child.displayPath = buildDisplayPath(\n            newFile,\n            child.properties.id,\n            parentNote.properties.id\n          );\n          updateChildrenPath(child);\n        }\n      }\n      updateChildrenPath(note);\n\n      markDirty();\n      return note;\n    },\n\n    // === \u540C\u6B65 ===\n\n    reload(): void {\n      load();\n    },\n\n    save(): void {\n      if (isDirty || !autoSave) {\n        saveToFile();\n      }\n    },\n\n    // === \u5B58\u53D6\u5167\u90E8\u72C0\u614B ===\n\n    getProjectRoot(): ProjectRoot | null {\n      return projectRoot;\n    },\n\n    getParseResult(): ParseResult | null {\n      return parseResult;\n    },\n  };\n}\n", "// BacklinkManager module - \u96D9\u5411\u9023\u7D50\u7BA1\u7406\n// Phase 1.4 \u5BE6\u4F5C\n\nimport type { Note, NoteId, LinkGraph, LinkEdge } from '../types/index.js';\n\n/**\n * BacklinkManager \u4ECB\u9762\n */\nexport interface BacklinkManager {\n  rebuildAll(notes: Note[]): void;\n  updateForNote(note: Note, oldContent: string, newContent: string): NoteId[];\n  removeNote(id: NoteId): NoteId[];\n  getLinkGraph(): LinkGraph;\n  getForwardLinks(id: NoteId): NoteId[];\n  getBackwardLinks(id: NoteId): NoteId[];\n  getBacklinkCount(id: NoteId): number;\n}\n\n/**\n * \u6B63\u5247\u8868\u9054\u5F0F\uFF1A\u63D0\u53D6\u7B46\u8A18\u5F15\u7528\n */\nconst NOTE_REF_PATTERN = /\\[\\[(cm\\.[a-z0-9]+)(?:\\|[^\\]]+)?\\]\\]/g;\n\n/**\n * \u5F9E\u5167\u5BB9\u4E2D\u63D0\u53D6\u6240\u6709\u7B46\u8A18\u5F15\u7528\n */\nfunction extractReferencesFromContent(content: string): NoteId[] {\n  const refs: NoteId[] = [];\n  const regex = new RegExp(NOTE_REF_PATTERN.source, 'g');\n  let match;\n  while ((match = regex.exec(content)) !== null) {\n    const id = match[1] as NoteId;\n    if (!refs.includes(id)) {\n      refs.push(id);\n    }\n  }\n  return refs;\n}\n\n/**\n * \u5F9E\u7B46\u8A18\u4E2D\u63D0\u53D6\u6240\u6709\u5F15\u7528\uFF08\u5305\u542B related \u5C6C\u6027\u548C\u5167\u5BB9\uFF09\n */\nfunction extractAllReferences(note: Note): NoteId[] {\n  const refs: NoteId[] = [];\n\n  // \u5F9E related \u5C6C\u6027\n  if (note.properties.related) {\n    for (const ref of note.properties.related) {\n      if (!refs.includes(ref)) {\n        refs.push(ref);\n      }\n    }\n  }\n\n  // \u5F9E\u5167\u5BB9\n  for (const line of note.content) {\n    if (line.references) {\n      for (const ref of line.references) {\n        if (!refs.includes(ref)) {\n          refs.push(ref);\n        }\n      }\n    }\n    // \u4E5F\u89E3\u6790\u5167\u5BB9\u6587\u5B57\u4E2D\u7684\u5F15\u7528\n    const contentRefs = extractReferencesFromContent(line.content);\n    for (const ref of contentRefs) {\n      if (!refs.includes(ref)) {\n        refs.push(ref);\n      }\n    }\n  }\n\n  return refs;\n}\n\n/**\n * \u5EFA\u7ACB BacklinkManager \u5BE6\u4F8B\n */\nexport function createBacklinkManager(): BacklinkManager {\n  // \u6B63\u5411\u9023\u7D50: noteId -> [\u5F15\u7528\u7684 noteIds]\n  const forwardLinks = new Map<NoteId, NoteId[]>();\n  // \u53CD\u5411\u9023\u7D50: noteId -> [\u88AB\u54EA\u4E9B noteIds \u5F15\u7528]\n  const backwardLinks = new Map<NoteId, NoteId[]>();\n  // \u6240\u6709\u5DF2\u77E5\u7684\u7B46\u8A18 ID\n  const knownNotes = new Set<NoteId>();\n\n  /**\n   * \u65B0\u589E\u6B63\u5411\u9023\u7D50\n   */\n  function addForwardLink(fromId: NoteId, toId: NoteId): void {\n    const existing = forwardLinks.get(fromId) || [];\n    if (!existing.includes(toId)) {\n      existing.push(toId);\n      forwardLinks.set(fromId, existing);\n    }\n  }\n\n  /**\n   * \u65B0\u589E\u53CD\u5411\u9023\u7D50\n   */\n  function addBackwardLink(fromId: NoteId, toId: NoteId): void {\n    const existing = backwardLinks.get(toId) || [];\n    if (!existing.includes(fromId)) {\n      existing.push(fromId);\n      backwardLinks.set(toId, existing);\n    }\n  }\n\n  /**\n   * \u79FB\u9664\u6B63\u5411\u9023\u7D50\n   */\n  function removeForwardLink(fromId: NoteId, toId: NoteId): void {\n    const existing = forwardLinks.get(fromId) || [];\n    const idx = existing.indexOf(toId);\n    if (idx !== -1) {\n      existing.splice(idx, 1);\n      forwardLinks.set(fromId, existing);\n    }\n  }\n\n  /**\n   * \u79FB\u9664\u53CD\u5411\u9023\u7D50\n   */\n  function removeBackwardLink(fromId: NoteId, toId: NoteId): void {\n    const existing = backwardLinks.get(toId) || [];\n    const idx = existing.indexOf(fromId);\n    if (idx !== -1) {\n      existing.splice(idx, 1);\n      backwardLinks.set(toId, existing);\n    }\n  }\n\n  /**\n   * \u6E05\u9664\u67D0\u7B46\u8A18\u7684\u6240\u6709\u9023\u7D50\n   */\n  function clearLinksForNote(id: NoteId): void {\n    // \u6E05\u9664\u6B64\u7B46\u8A18\u7684\u6B63\u5411\u9023\u7D50\n    const forwards = forwardLinks.get(id) || [];\n    for (const toId of forwards) {\n      removeBackwardLink(id, toId);\n    }\n    forwardLinks.delete(id);\n\n    // \u6E05\u9664\u6307\u5411\u6B64\u7B46\u8A18\u7684\u53CD\u5411\u9023\u7D50\n    const backwards = backwardLinks.get(id) || [];\n    for (const fromId of backwards) {\n      removeForwardLink(fromId, id);\n    }\n    backwardLinks.delete(id);\n  }\n\n  /**\n   * \u91CD\u5EFA\u6240\u6709\u9023\u7D50\n   */\n  function rebuildAll(notes: Note[]): void {\n    // \u6E05\u7A7A\u6240\u6709\u9023\u7D50\n    forwardLinks.clear();\n    backwardLinks.clear();\n    knownNotes.clear();\n\n    // \u6536\u96C6\u6240\u6709\u7B46\u8A18 ID\n    function collectNotes(noteList: Note[]) {\n      for (const note of noteList) {\n        knownNotes.add(note.properties.id);\n        if (note.children.length > 0) {\n          collectNotes(note.children);\n        }\n      }\n    }\n    collectNotes(notes);\n\n    // \u5EFA\u7ACB\u9023\u7D50\n    function processNotes(noteList: Note[]) {\n      for (const note of noteList) {\n        const refs = extractAllReferences(note);\n        for (const refId of refs) {\n          addForwardLink(note.properties.id, refId);\n          addBackwardLink(note.properties.id, refId);\n        }\n\n        if (note.children.length > 0) {\n          processNotes(note.children);\n        }\n      }\n    }\n    processNotes(notes);\n  }\n\n  /**\n   * \u66F4\u65B0\u7B46\u8A18\u7684\u9023\u7D50\uFF08\u7576\u5167\u5BB9\u8B8A\u66F4\u6642\uFF09\n   * \u8FD4\u56DE\u53D7\u5F71\u97FF\u7684\u7B46\u8A18 ID \u5217\u8868\n   */\n  function updateForNote(note: Note, oldContent: string, _newContent: string): NoteId[] {\n    const noteId = note.properties.id;\n    const affected: NoteId[] = [];\n\n    // \u63D0\u53D6\u820A\u5F15\u7528\u548C\u65B0\u5F15\u7528\n    const oldRefs = extractReferencesFromContent(oldContent);\n    const newRefs = extractAllReferences(note);\n\n    // \u627E\u51FA\u88AB\u79FB\u9664\u7684\u5F15\u7528\n    for (const oldRef of oldRefs) {\n      if (!newRefs.includes(oldRef)) {\n        removeForwardLink(noteId, oldRef);\n        removeBackwardLink(noteId, oldRef);\n        if (!affected.includes(oldRef)) {\n          affected.push(oldRef);\n        }\n      }\n    }\n\n    // \u627E\u51FA\u65B0\u589E\u7684\u5F15\u7528\n    for (const newRef of newRefs) {\n      if (!oldRefs.includes(newRef)) {\n        addForwardLink(noteId, newRef);\n        addBackwardLink(noteId, newRef);\n        if (!affected.includes(newRef)) {\n          affected.push(newRef);\n        }\n      }\n    }\n\n    return affected;\n  }\n\n  /**\n   * \u79FB\u9664\u7B46\u8A18\u6642\u6E05\u7406\u9023\u7D50\n   * \u8FD4\u56DE\u53D7\u5F71\u97FF\u7684\u7B46\u8A18 ID \u5217\u8868\n   */\n  function removeNote(id: NoteId): NoteId[] {\n    const affected: NoteId[] = [];\n\n    // \u6536\u96C6\u53D7\u5F71\u97FF\u7684\u7B46\u8A18\n    const forwards = forwardLinks.get(id) || [];\n    const backwards = backwardLinks.get(id) || [];\n\n    for (const refId of forwards) {\n      if (!affected.includes(refId)) {\n        affected.push(refId);\n      }\n    }\n    for (const refId of backwards) {\n      if (!affected.includes(refId)) {\n        affected.push(refId);\n      }\n    }\n\n    // \u6E05\u9664\u9023\u7D50\n    clearLinksForNote(id);\n    knownNotes.delete(id);\n\n    return affected;\n  }\n\n  /**\n   * \u53D6\u5F97\u9023\u7D50\u5716\n   */\n  function getLinkGraph(): LinkGraph {\n    const nodes = [...knownNotes];\n    const edges: LinkEdge[] = [];\n\n    for (const [fromId, toIds] of forwardLinks) {\n      for (const toId of toIds) {\n        edges.push({ from: fromId, to: toId });\n      }\n    }\n\n    return { nodes, edges };\n  }\n\n  /**\n   * \u53D6\u5F97\u67D0\u7B46\u8A18\u7684\u6B63\u5411\u9023\u7D50\n   */\n  function getForwardLinks(id: NoteId): NoteId[] {\n    return forwardLinks.get(id) || [];\n  }\n\n  /**\n   * \u53D6\u5F97\u67D0\u7B46\u8A18\u7684\u53CD\u5411\u9023\u7D50\n   */\n  function getBackwardLinks(id: NoteId): NoteId[] {\n    return backwardLinks.get(id) || [];\n  }\n\n  /**\n   * \u53D6\u5F97\u67D0\u7B46\u8A18\u7684\u88AB\u5F15\u7528\u6B21\u6578\n   */\n  function getBacklinkCount(id: NoteId): number {\n    return (backwardLinks.get(id) || []).length;\n  }\n\n  return {\n    rebuildAll,\n    updateForNote,\n    removeNote,\n    getLinkGraph,\n    getForwardLinks,\n    getBackwardLinks,\n    getBacklinkCount,\n  };\n}\n\n// \u5C0E\u51FA\u8F14\u52A9\u51FD\u6578\u4F9B\u6E2C\u8A66\u4F7F\u7528\nexport { extractReferencesFromContent, extractAllReferences };\n", "// ID Generator module - \u552F\u4E00 ID \u7522\u751F\n// Phase 1.6 \u5BE6\u4F5C\n\nimport type { NoteId, NotePath } from '../types/index.js';\n\n/**\n * ID \u7522\u751F\u5668\u4ECB\u9762\n */\nexport interface IdGenerator {\n  generateId(): NoteId;\n  generateUniqueId(existingIds: Set<NoteId>): NoteId;\n  isValidId(id: string): id is NoteId;\n  generateDisplayPath(file: string, id: NoteId, parentId?: NoteId): NotePath;\n  extractIdFromRef(ref: string): NoteId | null;\n  parseDisplayPath(displayPath: NotePath): {\n    file: string;\n    id: string;\n    parentId?: string;\n  } | null;\n}\n\n/**\n * ID \u7522\u751F\u5668\u9078\u9805\n */\nexport interface IdGeneratorOptions {\n  /** ID \u9577\u5EA6 (\u9810\u8A2D: 6) */\n  idLength?: number;\n  /** \u5B57\u5143\u96C6 (\u9810\u8A2D: \u5C0F\u5BEB\u5B57\u6BCD + \u6578\u5B57) */\n  alphabet?: string;\n  /** \u81EA\u8A02\u96A8\u6A5F\u51FD\u6578 (\u4F9B\u6E2C\u8A66\u4F7F\u7528) */\n  randomFn?: () => number;\n}\n\n/**\n * \u9810\u8A2D\u5B57\u5143\u96C6\uFF1A\u5C0F\u5BEB\u5B57\u6BCD + \u6578\u5B57\n */\nconst DEFAULT_ALPHABET = 'abcdefghijklmnopqrstuvwxyz0123456789';\n\n/**\n * ID \u9A57\u8B49\u6B63\u5247\u8868\u9054\u5F0F\n */\nconst ID_PATTERN = /^cm\\.[a-z0-9]{6}$/;\n\n/**\n * \u7B46\u8A18\u5F15\u7528\u6B63\u5247\u8868\u9054\u5F0F: [[cm.xxx]] \u6216 [[cm.xxx|display]]\n */\nconst REF_PATTERN = /^\\[\\[(cm\\.[a-z0-9]+)(?:\\|[^\\]]+)?\\]\\]$/;\n\n/**\n * \u5EFA\u7ACB ID \u7522\u751F\u5668\u5BE6\u4F8B\n */\nexport function createIdGenerator(options: IdGeneratorOptions = {}): IdGenerator {\n  const { idLength = 6, alphabet = DEFAULT_ALPHABET, randomFn = Math.random } = options;\n\n  /**\n   * \u7522\u751F\u96A8\u6A5F hash\n   */\n  function generateHash(): string {\n    let hash = '';\n    for (let i = 0; i < idLength; i++) {\n      const idx = Math.floor(randomFn() * alphabet.length);\n      hash += alphabet[idx];\n    }\n    return hash;\n  }\n\n  /**\n   * \u7522\u751F NoteId\n   */\n  function generateId(): NoteId {\n    return `cm.${generateHash()}` as NoteId;\n  }\n\n  /**\n   * \u7522\u751F\u552F\u4E00\u7684 NoteId (\u907F\u514D\u8207\u73FE\u6709 ID \u885D\u7A81)\n   */\n  function generateUniqueId(existingIds: Set<NoteId>): NoteId {\n    let id: NoteId;\n    let attempts = 0;\n    const maxAttempts = 1000;\n\n    do {\n      id = generateId();\n      attempts++;\n\n      if (attempts >= maxAttempts) {\n        throw new Error('Unable to generate unique ID after maximum attempts');\n      }\n    } while (existingIds.has(id));\n\n    return id;\n  }\n\n  /**\n   * \u9A57\u8B49 ID \u683C\u5F0F\n   */\n  function isValidId(id: string): id is NoteId {\n    return ID_PATTERN.test(id);\n  }\n\n  /**\n   * \u7522\u751F\u986F\u793A\u8DEF\u5F91\n   */\n  function generateDisplayPath(file: string, id: NoteId, parentId?: NoteId): NotePath {\n    const idHash = id.replace('cm.', '');\n\n    if (parentId) {\n      const parentHash = parentId.replace('cm.', '');\n      return `${file}/${parentHash}/${idHash}`;\n    }\n\n    return `${file}/${idHash}`;\n  }\n\n  /**\n   * \u5F9E\u5F15\u7528\u5B57\u4E32\u63D0\u53D6 ID\n   * \u652F\u63F4: [[cm.xxx]] \u6216 [[cm.xxx|display]]\n   */\n  function extractIdFromRef(ref: string): NoteId | null {\n    const match = ref.match(REF_PATTERN);\n    if (match && match[1]) {\n      return match[1] as NoteId;\n    }\n    return null;\n  }\n\n  /**\n   * \u89E3\u6790\u986F\u793A\u8DEF\u5F91\n   */\n  function parseDisplayPath(\n    displayPath: NotePath\n  ): { file: string; id: string; parentId?: string } | null {\n    const parts = displayPath.split('/');\n\n    if (parts.length < 2) {\n      return null;\n    }\n\n    // \u683C\u5F0F: file/hash \u6216 file/parentHash/hash\n    if (parts.length === 2) {\n      return {\n        file: parts[0] || '',\n        id: parts[1] || '',\n      };\n    }\n\n    if (parts.length >= 3) {\n      // \u6A94\u6848\u540D\u53EF\u80FD\u5305\u542B /\uFF0C\u53D6\u6700\u5F8C\u5169\u500B\u90E8\u5206\u4F5C\u70BA parentHash/hash\n      const id = parts[parts.length - 1] || '';\n      const parentId = parts[parts.length - 2] || '';\n      const file = parts.slice(0, parts.length - 2).join('/');\n\n      return {\n        file,\n        id,\n        parentId,\n      };\n    }\n\n    return null;\n  }\n\n  return {\n    generateId,\n    generateUniqueId,\n    isValidId,\n    generateDisplayPath,\n    extractIdFromRef,\n    parseDisplayPath,\n  };\n}\n\n// \u5C0E\u51FA\u9810\u8A2D\u5BE6\u4F8B\u7684\u4FBF\u6377\u51FD\u6578\nconst defaultGenerator = createIdGenerator();\n\nexport const generateId = defaultGenerator.generateId;\nexport const generateUniqueId = defaultGenerator.generateUniqueId;\nexport const isValidId = defaultGenerator.isValidId;\nexport const generateDisplayPath = defaultGenerator.generateDisplayPath;\nexport const extractIdFromRef = defaultGenerator.extractIdFromRef;\nexport const parseDisplayPath = defaultGenerator.parseDisplayPath;\n", "// Autocomplete Provider\n// Phase 5.2.1 \u5BE6\u4F5C\n\nimport * as vscode from 'vscode';\nimport { extensionStore, getRelativeFilePath } from '../store.js';\n\n/**\n * \u7B46\u8A18\u81EA\u52D5\u5B8C\u6210\u63D0\u4F9B\u8005\n * Triggers on [[ to provide note references\n */\nexport class NoteCompletionProvider implements vscode.CompletionItemProvider {\n  provideCompletionItems(\n    document: vscode.TextDocument,\n    position: vscode.Position,\n    _token: vscode.CancellationToken,\n    _context: vscode.CompletionContext\n  ): vscode.ProviderResult<vscode.CompletionItem[] | vscode.CompletionList> {\n    // Check if we're in a [[ context\n    const linePrefix = document.lineAt(position).text.substring(0, position.character);\n    if (!linePrefix.includes('[[')) {\n      return [];\n    }\n\n    // Find the start of the current reference\n    const lastBrackets = linePrefix.lastIndexOf('[[');\n    if (lastBrackets === -1) {\n      return [];\n    }\n\n    // Get the text after [[\n    const searchText = linePrefix.substring(lastBrackets + 2);\n\n    // Don't complete if already closed\n    if (searchText.includes(']]')) {\n      return [];\n    }\n\n    const items: vscode.CompletionItem[] = [];\n    const notes = extensionStore.getAllNotes();\n    const currentFile = getRelativeFilePath(document.uri.fsPath);\n\n    // Sort notes: current file first, then by backlink count\n    const sortedNotes = [...notes].sort((a, b) => {\n      const aInCurrentFile = a.properties.file === currentFile;\n      const bInCurrentFile = b.properties.file === currentFile;\n\n      if (aInCurrentFile && !bInCurrentFile) return -1;\n      if (!aInCurrentFile && bInCurrentFile) return 1;\n\n      // Sort by backlink count\n      return (b.properties.backlink_count || 0) - (a.properties.backlink_count || 0);\n    });\n\n    // Add completion items for each note\n    for (let i = 0; i < sortedNotes.length; i++) {\n      const note = sortedNotes[i]!;\n\n      // Skip if doesn't match search\n      if (searchText && !note.displayPath.toLowerCase().includes(searchText.toLowerCase())) {\n        continue;\n      }\n\n      const item = new vscode.CompletionItem(note.displayPath, vscode.CompletionItemKind.Reference);\n\n      // Insert the full reference with display text\n      item.insertText = `${note.properties.id}|${note.displayPath}]]`;\n\n      // Replace from [[ to cursor\n      const range = new vscode.Range(\n        position.line,\n        lastBrackets + 2,\n        position.line,\n        position.character\n      );\n      item.range = range;\n\n      // Show note content in detail\n      const summary = note.content[0]?.content || 'No content';\n      item.detail = `${note.properties.file || 'unknown'} - ${note.properties.author}`;\n      item.documentation = new vscode.MarkdownString(\n        `**${note.displayPath}**\\n\\n${summary}\\n\\n*References: ${note.properties.backlink_count || 0}*`\n      );\n\n      // Sort order\n      item.sortText = String(i).padStart(5, '0');\n\n      // Highlight notes in current file\n      if (note.properties.file === currentFile) {\n        item.label = `\u2605 ${note.displayPath}`;\n      }\n\n      items.push(item);\n    }\n\n    // Add \"Create new note\" option if searching\n    if (searchText && searchText.length > 2) {\n      const createItem = new vscode.CompletionItem(\n        `Create: \"${searchText}\"`,\n        vscode.CompletionItemKind.Event\n      );\n      createItem.insertText = `codemind: ${searchText}}}`;\n      createItem.range = new vscode.Range(\n        position.line,\n        lastBrackets,\n        position.line,\n        position.character\n      );\n      createItem.detail = 'Create a new Code-Mind note';\n      createItem.documentation = new vscode.MarkdownString(\n        'Insert a marker to create a new note. The daemon will process this and generate an ID.'\n      );\n      createItem.sortText = 'zzz'; // Put at end\n      items.push(createItem);\n    }\n\n    return items;\n  }\n}\n", "// Hover Provider\n// Phase 5.2.2 \u5BE6\u4F5C\n\nimport * as vscode from 'vscode';\nimport { extensionStore, getNoteReferenceAtPosition } from '../store.js';\nimport type { NoteId } from '@inkstone/codemind-core';\n\n/**\n * Simple cache for hover content\n */\nconst hoverCache = new Map<string, { content: vscode.MarkdownString; timestamp: number }>();\nconst CACHE_TTL = 30000; // 30 seconds\n\n/**\n * \u7B46\u8A18\u61F8\u505C\u63D0\u4F9B\u8005\n * Shows note preview on hover over [[cm.xxx]] references\n */\nexport class NoteHoverProvider implements vscode.HoverProvider {\n  provideHover(\n    document: vscode.TextDocument,\n    position: vscode.Position,\n    _token: vscode.CancellationToken\n  ): vscode.ProviderResult<vscode.Hover> {\n    // Check if we're hovering over a note reference\n    const ref = getNoteReferenceAtPosition(document, position);\n    if (!ref) {\n      return null;\n    }\n\n    // Check cache\n    const cached = hoverCache.get(ref.id);\n    if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n      return new vscode.Hover(cached.content, ref.range);\n    }\n\n    // Get the note\n    const note = extensionStore.getNote(ref.id);\n    if (!note) {\n      const notFound = new vscode.MarkdownString(\n        `**Note not found:** \\`${ref.id}\\`\\n\\n*This note ID does not exist in codemind.md*`\n      );\n      return new vscode.Hover(notFound, ref.range);\n    }\n\n    // Build hover content\n    const content = buildHoverContent(ref.id, note);\n\n    // Cache the content\n    hoverCache.set(ref.id, { content, timestamp: Date.now() });\n\n    return new vscode.Hover(content, ref.range);\n  }\n}\n\n/**\n * Build the hover markdown content for a note\n */\nfunction buildHoverContent(\n  id: NoteId,\n  note: {\n    displayPath: string;\n    properties: {\n      file?: string;\n      line?: number;\n      author?: string;\n      created?: string;\n      backlink_count?: number;\n    };\n    content: Array<{ content: string; indent: number }>;\n  }\n): vscode.MarkdownString {\n  const md = new vscode.MarkdownString();\n  md.isTrusted = true;\n  md.supportHtml = true;\n\n  // Header\n  md.appendMarkdown(`### \uD83D\uDCDD ${note.displayPath}\\n\\n`);\n\n  // Properties\n  md.appendMarkdown('| Property | Value |\\n|---|---|\\n');\n  md.appendMarkdown(`| **ID** | \\`${id}\\` |\\n`);\n  if (note.properties.file) {\n    md.appendMarkdown(`| **File** | ${note.properties.file} |\\n`);\n  }\n  if (note.properties.line) {\n    md.appendMarkdown(`| **Line** | ${note.properties.line} |\\n`);\n  }\n  if (note.properties.author) {\n    md.appendMarkdown(`| **Author** | ${note.properties.author} |\\n`);\n  }\n  if (note.properties.created) {\n    md.appendMarkdown(`| **Created** | ${note.properties.created} |\\n`);\n  }\n  md.appendMarkdown('\\n');\n\n  // Content preview (first few lines)\n  if (note.content.length > 0) {\n    md.appendMarkdown('**Content:**\\n\\n');\n    const maxLines = 5;\n    const lines = note.content.slice(0, maxLines);\n    for (const line of lines) {\n      const indent = '  '.repeat(line.indent);\n      md.appendMarkdown(`${indent}- ${line.content}\\n`);\n    }\n    if (note.content.length > maxLines) {\n      md.appendMarkdown(`\\n*... and ${note.content.length - maxLines} more lines*\\n`);\n    }\n    md.appendMarkdown('\\n');\n  }\n\n  // Backlinks info\n  const backlinks = extensionStore.getBacklinks(id);\n  if (backlinks.length > 0) {\n    md.appendMarkdown(`**Referenced by:** ${backlinks.length} note(s)\\n\\n`);\n    const maxBacklinks = 3;\n    for (const bl of backlinks.slice(0, maxBacklinks)) {\n      md.appendMarkdown(`- \\`[[${bl.properties.id}]]\\` ${bl.displayPath}\\n`);\n    }\n    if (backlinks.length > maxBacklinks) {\n      md.appendMarkdown(`- *... and ${backlinks.length - maxBacklinks} more*\\n`);\n    }\n  } else {\n    md.appendMarkdown('**No references** (orphan note)\\n');\n  }\n\n  // Actions\n  md.appendMarkdown('\\n---\\n');\n  md.appendMarkdown(\n    `[Go to Definition](command:codemind.goToNote?${encodeURIComponent(JSON.stringify(id))}) | `\n  );\n  md.appendMarkdown(\n    `[Find References](command:codemind.findReferences?${encodeURIComponent(JSON.stringify(id))})`\n  );\n\n  return md;\n}\n\n/**\n * Clear the hover cache\n */\nexport function clearHoverCache(): void {\n  hoverCache.clear();\n}\n", "// CodeLens Provider\n// Phase 5.2.3 \u5BE6\u4F5C\n\nimport * as vscode from 'vscode';\nimport { extensionStore, NOTE_REFERENCE_PATTERN } from '../store.js';\nimport type { NoteId } from '@inkstone/codemind-core';\n\n/**\n * \u7B46\u8A18 CodeLens \u63D0\u4F9B\u8005\n * Shows reference count above note references\n */\nexport class NoteCodeLensProvider implements vscode.CodeLensProvider {\n  private _onDidChangeCodeLenses = new vscode.EventEmitter<void>();\n  readonly onDidChangeCodeLenses = this._onDidChangeCodeLenses.event;\n\n  constructor() {\n    // Refresh code lenses when store changes\n    extensionStore.onDidChange(() => {\n      this._onDidChangeCodeLenses.fire();\n    });\n  }\n\n  provideCodeLenses(\n    document: vscode.TextDocument,\n    _token: vscode.CancellationToken\n  ): vscode.ProviderResult<vscode.CodeLens[]> {\n    const codeLenses: vscode.CodeLens[] = [];\n    const text = document.getText();\n    const pattern = new RegExp(NOTE_REFERENCE_PATTERN.source, 'g');\n    const seenIds = new Set<string>();\n    let match;\n\n    while ((match = pattern.exec(text)) !== null) {\n      const noteId = match[1] as NoteId;\n\n      // Only show one CodeLens per note ID per document\n      if (seenIds.has(noteId)) {\n        continue;\n      }\n      seenIds.add(noteId);\n\n      const pos = document.positionAt(match.index);\n      const range = new vscode.Range(pos, pos);\n\n      // Get note info\n      const note = extensionStore.getNote(noteId);\n      const backlinks = extensionStore.getBacklinks(noteId);\n\n      // Debug logging\n      const allNotes = extensionStore.getAllNotes();\n      console.log(`[CodeLens] Looking for ${noteId}, store has ${allNotes.length} notes, found: ${!!note}`);\n\n      if (note) {\n        // Create CodeLens with reference count\n        const lens = new vscode.CodeLens(range, {\n          title: `${backlinks.length} reference${backlinks.length === 1 ? '' : 's'}`,\n          command: 'codemind.findReferences',\n          arguments: [noteId],\n          tooltip: `Show all references to ${note.displayPath}`,\n        });\n        codeLenses.push(lens);\n\n        // Add go to definition lens\n        const defLens = new vscode.CodeLens(range, {\n          title: '\u2197 Definition',\n          command: 'codemind.goToNote',\n          arguments: [noteId],\n          tooltip: `Go to definition of ${note.displayPath}`,\n        });\n        codeLenses.push(defLens);\n      } else {\n        // Note not found\n        const lens = new vscode.CodeLens(range, {\n          title: '\u26A0 Note not found',\n          command: '',\n          tooltip: `Note ${noteId} does not exist in codemind.md`,\n        });\n        codeLenses.push(lens);\n      }\n    }\n\n    return codeLenses;\n  }\n}\n", "// Definition Provider\n// Phase 5.2.4 \u5BE6\u4F5C\n\nimport * as vscode from 'vscode';\nimport { getNoteReferenceAtPosition, getNoteDefinitionLocation } from '../store.js';\n\n/**\n * \u7B46\u8A18\u5B9A\u7FA9\u63D0\u4F9B\u8005 (F12 \u8DF3\u8F49)\n * Navigates to the note definition in codemind.md\n */\nexport class NoteDefinitionProvider implements vscode.DefinitionProvider {\n  async provideDefinition(\n    document: vscode.TextDocument,\n    position: vscode.Position,\n    _token: vscode.CancellationToken\n  ): Promise<vscode.Definition | vscode.LocationLink[] | null> {\n    // Check if we're on a note reference\n    const ref = getNoteReferenceAtPosition(document, position);\n    if (!ref) {\n      return null;\n    }\n\n    // Get the definition location\n    const location = await getNoteDefinitionLocation(ref.id);\n    if (!location) {\n      vscode.window.showWarningMessage(`Note definition not found: ${ref.id}`);\n      return null;\n    }\n\n    return location;\n  }\n}\n", "// Reference Provider\n// Phase 5.2.5 \u5BE6\u4F5C\n\nimport * as vscode from 'vscode';\nimport {\n  getNoteReferenceAtPosition,\n  findNoteReferences,\n  getNoteDefinitionLocation,\n} from '../store.js';\n\n/**\n * \u7B46\u8A18\u5F15\u7528\u63D0\u4F9B\u8005 (Shift+F12)\n * Shows all references to a note in the workspace\n */\nexport class NoteReferenceProvider implements vscode.ReferenceProvider {\n  async provideReferences(\n    document: vscode.TextDocument,\n    position: vscode.Position,\n    context: vscode.ReferenceContext,\n    _token: vscode.CancellationToken\n  ): Promise<vscode.Location[]> {\n    // Check if we're on a note reference\n    const ref = getNoteReferenceAtPosition(document, position);\n    if (!ref) {\n      return [];\n    }\n\n    // Find all references in the workspace\n    const locations = await findNoteReferences(ref.id);\n\n    // Include the definition location if requested\n    if (context.includeDeclaration) {\n      const defLocation = await getNoteDefinitionLocation(ref.id);\n      if (defLocation) {\n        // Add at the beginning\n        locations.unshift(defLocation);\n      }\n    }\n\n    return locations;\n  }\n}\n", "// TreeView Provider\n// Phase 5.2.6 \u5BE6\u4F5C\n\nimport * as vscode from 'vscode';\nimport { extensionStore } from '../store.js';\nimport type { Note, NoteId } from '@inkstone/codemind-core';\n\n/**\n * Tree item types\n */\ntype TreeItemType = 'category' | 'file' | 'note';\n\n/**\n * \u7B46\u8A18\u6A39\u72C0\u6AA2\u8996\u9805\u76EE\n */\nexport class NoteTreeItem extends vscode.TreeItem {\n  constructor(\n    public readonly label: string,\n    public readonly collapsibleState: vscode.TreeItemCollapsibleState,\n    public readonly itemType: TreeItemType,\n    public readonly noteId?: NoteId,\n    public readonly filePath?: string\n  ) {\n    super(label, collapsibleState);\n\n    // Set context value for menus\n    this.contextValue = itemType;\n\n    // Set icons based on type\n    switch (itemType) {\n      case 'category':\n        this.iconPath = new vscode.ThemeIcon('folder');\n        break;\n      case 'file':\n        this.iconPath = new vscode.ThemeIcon('file-code');\n        break;\n      case 'note':\n        this.iconPath = new vscode.ThemeIcon('note');\n        break;\n    }\n\n    // Set command for notes\n    if (itemType === 'note' && noteId) {\n      this.command = {\n        command: 'codemind.goToNote',\n        title: 'Go to Note',\n        arguments: [noteId],\n      };\n    }\n  }\n}\n\n/**\n * \u7B46\u8A18\u6A39\u72C0\u6AA2\u8996\u63D0\u4F9B\u8005\n */\nexport class NoteTreeProvider implements vscode.TreeDataProvider<NoteTreeItem> {\n  private _onDidChangeTreeData = new vscode.EventEmitter<NoteTreeItem | undefined | void>();\n  readonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n  constructor() {\n    // Refresh when store changes\n    extensionStore.onDidChange(() => {\n      this.refresh();\n    });\n\n    // Refresh when active editor changes\n    vscode.window.onDidChangeActiveTextEditor(() => {\n      this.refresh();\n    });\n  }\n\n  refresh(): void {\n    this._onDidChangeTreeData.fire();\n  }\n\n  getTreeItem(element: NoteTreeItem): vscode.TreeItem {\n    return element;\n  }\n\n  getChildren(element?: NoteTreeItem): vscode.ProviderResult<NoteTreeItem[]> {\n    if (!element) {\n      // Root level - show categories\n      return this.getRootCategories();\n    }\n\n    // Handle category children\n    if (element.itemType === 'category') {\n      const category = element.label as string;\n      switch (category) {\n        case 'Current File':\n          return this.getCurrentFileNotes();\n        case 'All Notes':\n          return this.getAllNotesGroupedByFile();\n        case 'Orphan Notes':\n          return this.getOrphanNotes();\n        case 'Popular Notes':\n          return this.getPopularNotes();\n        default:\n          return [];\n      }\n    }\n\n    // Handle file children (notes in that file)\n    if (element.itemType === 'file' && element.filePath) {\n      return this.getNotesInFile(element.filePath);\n    }\n\n    // Handle note children (child notes)\n    if (element.itemType === 'note' && element.noteId) {\n      return this.getChildNotes(element.noteId);\n    }\n\n    return [];\n  }\n\n  private getRootCategories(): NoteTreeItem[] {\n    const categories: NoteTreeItem[] = [];\n\n    // Current file notes\n    const activeEditor = vscode.window.activeTextEditor;\n    if (activeEditor) {\n      categories.push(\n        new NoteTreeItem('Current File', vscode.TreeItemCollapsibleState.Expanded, 'category')\n      );\n    }\n\n    // All notes\n    categories.push(\n      new NoteTreeItem('All Notes', vscode.TreeItemCollapsibleState.Collapsed, 'category')\n    );\n\n    // Orphan notes\n    const orphans = extensionStore.getStore()?.getOrphans() || [];\n    if (orphans.length > 0) {\n      const item = new NoteTreeItem(\n        'Orphan Notes',\n        vscode.TreeItemCollapsibleState.Collapsed,\n        'category'\n      );\n      item.description = `${orphans.length}`;\n      categories.push(item);\n    }\n\n    // Popular notes\n    categories.push(\n      new NoteTreeItem('Popular Notes', vscode.TreeItemCollapsibleState.Collapsed, 'category')\n    );\n\n    return categories;\n  }\n\n  private getCurrentFileNotes(): NoteTreeItem[] {\n    const activeEditor = vscode.window.activeTextEditor;\n    if (!activeEditor) {\n      return [];\n    }\n\n    const filePath = vscode.workspace.asRelativePath(activeEditor.document.uri);\n    const notes = extensionStore.getNotesInFile(filePath);\n\n    return this.createNoteItems(notes.filter(n => !n.properties.parent));\n  }\n\n  private getAllNotesGroupedByFile(): NoteTreeItem[] {\n    const allNotes = extensionStore.getAllNotes();\n    const byFile = new Map<string, Note[]>();\n\n    for (const note of allNotes) {\n      if (note.properties.parent) continue; // Skip child notes\n      const file = note.properties.file || 'unknown';\n      const existing = byFile.get(file) || [];\n      existing.push(note);\n      byFile.set(file, existing);\n    }\n\n    const items: NoteTreeItem[] = [];\n    const sortedFiles = [...byFile.keys()].sort();\n\n    for (const file of sortedFiles) {\n      const fileNotes = byFile.get(file) || [];\n      const item = new NoteTreeItem(\n        file,\n        vscode.TreeItemCollapsibleState.Collapsed,\n        'file',\n        undefined,\n        file\n      );\n      item.description = `${fileNotes.length} note${fileNotes.length === 1 ? '' : 's'}`;\n      items.push(item);\n    }\n\n    return items;\n  }\n\n  private getNotesInFile(filePath: string): NoteTreeItem[] {\n    const notes = extensionStore.getNotesInFile(filePath);\n    return this.createNoteItems(notes.filter(n => !n.properties.parent));\n  }\n\n  private getOrphanNotes(): NoteTreeItem[] {\n    const orphans = extensionStore.getStore()?.getOrphans() || [];\n    return this.createNoteItems(orphans);\n  }\n\n  private getPopularNotes(): NoteTreeItem[] {\n    const popular = extensionStore.getStore()?.getPopular(10) || [];\n    return this.createNoteItems(popular);\n  }\n\n  private getChildNotes(parentId: NoteId): NoteTreeItem[] {\n    const parent = extensionStore.getNote(parentId);\n    if (!parent) return [];\n    return this.createNoteItems(parent.children);\n  }\n\n  private createNoteItems(notes: Note[]): NoteTreeItem[] {\n    return notes.map(note => {\n      const hasChildren = note.children.length > 0;\n      const item = new NoteTreeItem(\n        note.displayPath,\n        hasChildren\n          ? vscode.TreeItemCollapsibleState.Collapsed\n          : vscode.TreeItemCollapsibleState.None,\n        'note',\n        note.properties.id\n      );\n\n      // Show backlink count as badge\n      const backlinkCount = note.properties.backlink_count || 0;\n      if (backlinkCount > 0) {\n        item.description = `[${backlinkCount}]`;\n      }\n\n      // Show content preview as tooltip\n      const content = note.content[0]?.content || 'No content';\n      item.tooltip = new vscode.MarkdownString(\n        `**${note.displayPath}**\\n\\n${content}\\n\\n*${note.properties.author} - ${note.properties.created}*`\n      );\n\n      return item;\n    });\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA,IAAAA,UAAwB;;;ACAxB,aAAwB;AACxB,WAAsB;;;ACqBtB,IAAM,WAAW;;EAEf,cAAc;;EAEd,aAAa;EACb,gBAAgB;;EAEhB,aAAa;;EAEb,WAAW;;EAEX,UAAU;;EAEV,SAAS;;EAET,YAAY;;EAEZ,cAAc;;EAEd,aAAa;;AAMf,SAAS,kBAAkB,SAAe;AACxC,QAAM,OAAiB,CAAA;AACvB,QAAM,QAAQ,IAAI,OAAO,SAAS,QAAQ,QAAQ,GAAG;AACrD,MAAI;AACJ,UAAQ,QAAQ,MAAM,KAAK,OAAO,OAAO,MAAM;AAC7C,UAAM,KAAK,MAAM,CAAC;AAClB,QAAI,CAAC,KAAK,SAAS,EAAE,GAAG;AACtB,WAAK,KAAK,EAAE;IACd;EACF;AACA,SAAO;AACT;AAKA,SAAS,eAAe,MAAY;AAClC,QAAM,QAAQ,KAAK,MAAM,QAAQ;AACjC,QAAM,SAAS,QAAQ,CAAC,GAAG,UAAU;AACrC,SAAO,KAAK,MAAM,SAAS,CAAC;AAC9B;AAKA,SAAS,eAAe,OAAe;AAIrC,MAAI,cAAkC;AACtC,QAAM,QAAgB,CAAA;AACtB,MAAI,cAAc;AAClB,MAAI,IAAI;AAGR,MAAI,cAAc;AAClB,MAAI,kBAAiB,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,KAAK;AAE/D,SAAO,IAAI,MAAM,QAAQ;AACvB,UAAM,OAAO,MAAM,CAAC,KAAK;AACzB,UAAM,UAAU,KAAK,KAAI;AACzB,UAAM,cAAc,eAAe,IAAI;AAGvC,QAAI,CAAC,SAAS;AACZ;AACA;IACF;AAGA,QAAI,SAAS,aAAa,KAAK,OAAO,GAAG;AACvC;AACA;IACF;AAGA,UAAM,YAAY,QAAQ,MAAM,SAAS,WAAW;AACpD,QAAI,WAAW;AACb,oBAAc,UAAU,CAAC,KAAK;AAC9B;AACA;IACF;AAGA,UAAM,eAAe,QAAQ,MAAM,SAAS,cAAc;AAC1D,QAAI,cAAc;AAChB,uBAAiB,aAAa,CAAC,KAAK;AACpC,oBAAc;QACZ,IAAI;QACJ,MAAM;QACN,MAAM;QACN,SAAS;QACT,cAAc,CAAA;QACd,KAAK,EAAE,WAAW,MAAM,OAAO,CAAA,EAAE;;AAEnC;AACA;IACF;AAGA,UAAM,YAAY,QAAQ,MAAM,SAAS,WAAW;AACpD,QAAI,WAAW;AACb,oBAAc,UAAU,CAAC,KAAK;AAC9B;AACA;IACF;AAGA,UAAM,YAAY,QAAQ,MAAM,SAAS,SAAS;AAClD,QAAI,aAAa,eAAe,GAAG;AACjC,YAAM,SAAS,UAAU,CAAC;AAC1B,YAAM,SAAS,OAAO,QAAQ,OAAO,EAAE;AAEvC,YAAM,OAAa;QACjB,YAAY;UACV,IAAI;UACJ,MAAM;UACN,QAAQ;UACR,UAAS,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,KAAK;;QAErD,SAAS,CAAA;QACT,UAAU,CAAA;QACV,aAAa,GAAG,WAAW,IAAI,MAAM;;AAGvC,YAAM,aAAa;AACnB;AAGA,aAAO,IAAI,MAAM,QAAQ;AACvB,cAAM,cAAc,MAAM,CAAC,KAAK;AAChC,cAAM,iBAAiB,YAAY,KAAI;AACvC,cAAM,gBAAgB,eAAe,WAAW;AAGhD,YAAI,CAAC,gBAAgB;AACnB;AACA;QACF;AAGA,YAAI,iBAAiB,YAAY;AAC/B;QACF;AAGA,cAAM,YAAY,eAAe,MAAM,SAAS,QAAQ;AACxD,YAAI,WAAW;AACb,eAAK,WAAW,SAAS,UAAU,CAAC;AACpC,eAAK,WAAW,UAAU,UAAU,CAAC,KAAK;AAC1C,cAAI,UAAU,CAAC,GAAG;AAChB,iBAAK,WAAW,OAAO,SAAS,UAAU,CAAC,GAAG,EAAE;UAClD;AACA;AACA;QACF;AAGA,cAAM,aAAa,eAAe,MAAM,SAAS,SAAS;AAC1D,YAAI,cAAc,kBAAkB,aAAa,GAAG;AAClD,gBAAM,UAAU,WAAW,CAAC;AAC5B,gBAAM,YAAY,QAAQ,QAAQ,OAAO,EAAE;AAE3C,gBAAM,QAAc;YAClB,YAAY;cACV,IAAI;cACJ,MAAM;cACN,QAAQ;cACR,UAAS,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,KAAK;cACnD,QAAQ;;YAEV,SAAS,CAAA;YACT,UAAU,CAAA;YACV,aAAa,GAAG,WAAW,IAAI,MAAM,IAAI,SAAS;;AAGpD,gBAAM,cAAc;AACpB;AAGA,iBAAO,IAAI,MAAM,QAAQ;AACvB,kBAAM,YAAY,MAAM,CAAC,KAAK;AAC9B,kBAAM,eAAe,UAAU,KAAI;AACnC,kBAAM,qBAAqB,eAAe,SAAS;AAEnD,gBAAI,CAAC,cAAc;AACjB;AACA;YACF;AAEA,gBAAI,sBAAsB,aAAa;AACrC;YACF;AAGA,kBAAM,iBAAiB,aAAa,MAAM,SAAS,QAAQ;AAC3D,gBAAI,gBAAgB;AAClB,oBAAM,WAAW,SAAS,eAAe,CAAC;AAC1C,oBAAM,WAAW,UAAU,eAAe,CAAC,KAAK;AAChD,kBAAI,eAAe,CAAC,GAAG;AACrB,sBAAM,WAAW,OAAO,SAAS,eAAe,CAAC,GAAG,EAAE;cACxD;AACA;AACA;YACF;AAGA,kBAAM,mBAAmB,aAAa,MAAM,SAAS,UAAU;AAC/D,gBAAI,kBAAkB;AACpB,oBAAM,iBAAiB,qBAAqB,cAAc;AAC1D,oBAAM,QAAQ,KAAK;gBACjB,QAAQ,KAAK,IAAI,GAAG,cAAc;gBAClC,SAAS,iBAAiB,CAAC,KAAK;gBAChC,YAAY,kBAAkB,iBAAiB,CAAC,KAAK,EAAE;eACxD;YACH;AACA;UACF;AAEA,eAAK,SAAS,KAAK,KAAK;AACxB;QACF;AAGA,cAAM,cAAc,eAAe,MAAM,SAAS,UAAU;AAC5D,YAAI,aAAa;AACf,gBAAM,iBAAiB,gBAAgB,aAAa;AACpD,eAAK,QAAQ,KAAK;YAChB,QAAQ,KAAK,IAAI,GAAG,cAAc;YAClC,SAAS,YAAY,CAAC,KAAK;YAC3B,YAAY,kBAAkB,YAAY,CAAC,KAAK,EAAE;WACnD;QACH;AACA;MACF;AAEA,YAAM,KAAK,IAAI;AACf;IACF;AAEA;EACF;AAGA,MAAI,CAAC,aAAa;AAChB,kBAAc;MACZ,IAAI;MACJ,MAAM;MACN,MAAM;MACN,SAAS;MACT,cAAc,CAAA;MACd,KAAK,EAAE,WAAW,MAAM,OAAO,CAAA,EAAE;;EAErC;AAEA,SAAO,EAAE,aAAa,MAAK;AAC7B;AAKA,SAAS,eAAe,OAAe;AAIrC,MAAI,cAAkC;AACtC,QAAM,QAAgB,CAAA;AACtB,MAAI,IAAI;AAGR,SAAO,IAAI,MAAM,QAAQ;AACvB,UAAM,OAAO,MAAM,CAAC,KAAK;AACzB,QAAI,KAAK,SAAS,mBAAmB,GAAG;AAEtC,UAAI,OAAO;AACX,UAAI,WAAU,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,KAAK;AAGxD,UAAI,IAAI,IAAI;AACZ,aAAO,IAAI,MAAM,UAAU,IAAI,IAAI,IAAI;AACrC,cAAM,WAAW,MAAM,CAAC,KAAK;AAC7B,cAAM,YAAY,SAAS,MAAM,eAAe;AAChD,cAAM,eAAe,SAAS,MAAM,kBAAkB;AACtD,YAAI;AAAW,iBAAO,UAAU,CAAC,KAAK;AACtC,YAAI;AAAc,oBAAU,aAAa,CAAC,KAAK;AAC/C;MACF;AAEA,oBAAc;QACZ,IAAI;QACJ,MAAM;QACN;QACA;QACA,cAAc,CAAA;QACd,KAAK,EAAE,WAAW,MAAM,OAAO,CAAA,EAAE;;AAEnC;IACF;AACA;EACF;AAGA,MAAI;AACJ,SAAO,IAAI,MAAM,QAAQ;AACvB,UAAM,OAAO,MAAM,CAAC,KAAK;AACzB,UAAM,YAAY,KAAK,MAAM,SAAS,YAAY;AAElD,QAAI,WAAW;AACb,YAAM,SAAS,UAAU,CAAC;AAC1B,YAAM,SAAS,OAAO,QAAQ,OAAO,EAAE;AAEvC,YAAM,OAAa;QACjB,YAAY;UACV,IAAI;UACJ,QAAQ;UACR,UAAS,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,KAAK;;QAErD,SAAS,CAAA;QACT,UAAU,CAAA;QACV,aAAa;;AAGf;AAGA,aAAO,IAAI,MAAM,QAAQ;AACvB,cAAM,WAAW,MAAM,CAAC,KAAK;AAC7B,cAAM,cAAc,SAAS,KAAI;AAGjC,YAAI,YAAY,WAAW,IAAI,GAAG;AAChC;QACF;AAGA,YAAI,SAAS,MAAM,SAAS,YAAY,GAAG;AACzC;QACF;AAGA,cAAM,YAAY,YAAY,MAAM,SAAS,WAAW;AAExD,YAAI,CAAC,WAAW;AACd;AACA;QACF;AAEA,cAAM,MAAM,UAAU,CAAC;AACvB,cAAM,QAAQ,UAAU,CAAC,KAAK;AAC9B,gBAAQ,KAAK;UACX,KAAK;AAEH;UACF,KAAK;AACH,iBAAK,WAAW,OAAO;AACvB;UACF,KAAK;AACH,iBAAK,WAAW,OAAO,SAAS,SAAS,KAAK,EAAE;AAChD;UACF,KAAK;AACH,iBAAK,WAAW,SAAU,SAAwB;AAClD;UACF,KAAK;AACH,iBAAK,WAAW,UAAU,SAAS;AACnC;UACF,KAAK;AACH,iBAAK,WAAW,SAAS;AACzB;QACJ;AACA;MACF;AAGA,aAAO,IAAI,MAAM,QAAQ;AACvB,cAAM,cAAc,MAAM,CAAC,KAAK;AAChC,YAAI,YAAY,MAAM,SAAS,YAAY,GAAG;AAC5C;QACF;AAEA,cAAM,cAAc,YAAY,MAAM,eAAe;AACrD,YAAI,aAAa;AACf,gBAAMC,UAAS,KAAK,OAAO,YAAY,CAAC,GAAG,UAAU,KAAK,CAAC,IAAI;AAC/D,gBAAM,UAAU,YAAY,CAAC,KAAK;AAClC,cAAIA,WAAU,GAAG;AACf,iBAAK,QAAQ,KAAK;cAChB,QAAAA;cACA;cACA,YAAY,kBAAkB,OAAO;aACtC;UACH;QACF;AACA;MACF;AAGA,YAAM,OAAO,KAAK,WAAW,QAAQ;AACrC,WAAK,cAAc,KAAK,WAAW,SAC/B,GAAG,IAAI,IAAI,KAAK,WAAW,OAAO,QAAQ,OAAO,EAAE,CAAC,IAAI,MAAM,KAC9D,GAAG,IAAI,IAAI,MAAM;AAErB,YAAM,KAAK,IAAI;AACf;IACF;AAEA;EACF;AAEA,SAAO,EAAE,aAAa,MAAK;AAC7B;AAKA,SAAS,aAAa,SAAe;AAEnC,MAAI,QAAQ,SAAS,OAAO,KAAK,kBAAkB,KAAK,OAAO,GAAG;AAEhE,QAAI,CAAC,QAAQ,SAAS,UAAU,GAAG;AACjC,aAAO;IACT;EACF;AAEA,MAAI,QAAQ,SAAS,UAAU,GAAG;AAChC,WAAO;EACT;AACA,SAAO;AACT;AAKA,SAAS,kBAAkB,OAAwB;AACjD,QAAM,eAAe,oBAAI,IAAG;AAE5B,aAAW,CAAC,IAAI,IAAI,KAAK,OAAO;AAC9B,UAAM,OAAiB,CAAA;AAGvB,QAAI,KAAK,WAAW,SAAS;AAC3B,WAAK,KAAK,GAAG,KAAK,WAAW,OAAO;IACtC;AAGA,eAAW,QAAQ,KAAK,SAAS;AAC/B,UAAI,KAAK,YAAY;AACnB,mBAAW,OAAO,KAAK,YAAY;AACjC,cAAI,CAAC,KAAK,SAAS,GAAG,GAAG;AACvB,iBAAK,KAAK,GAAG;UACf;QACF;MACF;IACF;AAEA,iBAAa,IAAI,IAAI,IAAI;EAC3B;AAEA,SAAO;AACT;AAKA,SAAS,mBAAmB,cAAmC;AAC7D,QAAM,gBAAgB,oBAAI,IAAG;AAE7B,aAAW,CAAC,QAAQ,KAAK,KAAK,cAAc;AAC1C,eAAW,QAAQ,OAAO;AACxB,YAAM,WAAW,cAAc,IAAI,IAAI,KAAK,CAAA;AAC5C,UAAI,CAAC,SAAS,SAAS,MAAM,GAAG;AAC9B,iBAAS,KAAK,MAAM;MACtB;AACA,oBAAc,IAAI,MAAM,QAAQ;IAClC;EACF;AAEA,SAAO;AACT;AAKA,SAAS,aAAa,OAAe,QAAyB;AAC5D,aAAW,QAAQ,OAAO;AACxB,WAAO,IAAI,KAAK,WAAW,IAAI,IAAI;AACnC,QAAI,KAAK,SAAS,SAAS,GAAG;AAC5B,mBAAa,KAAK,UAAU,MAAM;IACpC;EACF;AACF;AAKA,SAAS,kBACP,OACA,MACA,QAAoB;AAEpB,aAAW,QAAQ,OAAO;AACxB,QAAI,KAAK,IAAI,KAAK,WAAW,EAAE,GAAG;AAChC,aAAO,KAAK;QACV,MAAM;QACN,MAAM;QACN,SAAS,sBAAsB,KAAK,WAAW,EAAE;OAClD;IACH;AACA,SAAK,IAAI,KAAK,WAAW,EAAE;AAC3B,sBAAkB,KAAK,UAAU,MAAM,MAAM;EAC/C;AACF;AAKA,SAAS,sBACP,OACA,cACA,UAAwB;AAExB,aAAW,CAAC,QAAQ,KAAK,KAAK,cAAc;AAC1C,eAAW,QAAQ,OAAO;AACxB,UAAI,CAAC,MAAM,IAAI,IAAI,GAAG;AACpB,iBAAS,KAAK;UACZ,MAAM;UACN,MAAM;UACN,SAAS,QAAQ,MAAM,iCAAiC,IAAI;SAC7D;MACH;IACF;EACF;AACF;AAKA,SAAS,MAAM,SAAe;AAC5B,QAAM,SAAuB,CAAA;AAC7B,QAAM,WAA2B,CAAA;AAGjC,QAAM,SAAS,aAAa,OAAO;AACnC,QAAM,QAAQ,QAAQ,MAAM,IAAI;AAGhC,QAAM,EAAE,aAAa,MAAK,IACxB,WAAW,QAAQ,eAAe,KAAK,IAAI,eAAe,KAAK;AAGjE,QAAM,WAAW,oBAAI,IAAG;AACxB,eAAa,OAAO,QAAQ;AAG5B,QAAM,UAAU,oBAAI,IAAG;AACvB,oBAAkB,OAAO,SAAS,MAAM;AAGxC,QAAM,eAAe,kBAAkB,QAAQ;AAC/C,QAAM,gBAAgB,mBAAmB,YAAY;AAGrD,wBAAsB,UAAU,cAAc,QAAQ;AAEtD,SAAO;IACL;IACA,OAAO;IACP;IACA;IACA;IACA;;AAEJ;AAKA,SAAS,eAAe,OAAiB,YAAkB;AACzD,QAAM,UAAU,MAAM,KAAK,IAAI;AAC/B,QAAM,SAAS,MAAM,OAAO;AAC5B,QAAM,QAAQ,CAAC,GAAG,OAAO,MAAM,OAAM,CAAE;AACvC,SAAO,MAAM,CAAC,KAAK;AACrB;AAKM,SAAU,eAAY;AAC1B,SAAO;IACL;IACA;IACA;;AAEJ;;;ACplBA,SAAS,iBAAiB,OAAa;AACrC,QAAM,UAAU,oBAAI,IAAG;AAEvB,aAAW,QAAQ,OAAO;AACxB,UAAM,OAAO,KAAK,WAAW,QAAQ;AACrC,UAAM,WAAW,QAAQ,IAAI,IAAI,KAAK,CAAA;AACtC,aAAS,KAAK,IAAI;AAClB,YAAQ,IAAI,MAAM,QAAQ;EAC5B;AAEA,SAAO;AACT;AAKA,SAAS,WAAW,MAAY,YAAoB,IAAE;AACpD,MAAI,KAAK,QAAQ,WAAW,GAAG;AAC7B,WAAO;EACT;AACA,QAAM,YAAY,KAAK,QAAQ,CAAC,GAAG,WAAW;AAC9C,MAAI,UAAU,UAAU,WAAW;AACjC,WAAO;EACT;AACA,SAAO,UAAU,MAAM,GAAG,YAAY,CAAC,IAAI;AAC7C;AAMA,SAAS,eAAe,OAAqB;AAC3C,QAAM,QAAkB,CAAA;AACxB,QAAM,KAAK,MAAM,MAAM;AACvB,QAAM,KAAK,MAAM,OAAO;AACxB,MAAI,MAAM,SAAS,QAAW;AAC5B,UAAM,KAAK,QAAQ,MAAM,IAAI,EAAE;EACjC;AACA,SAAO,MAAM,KAAK,QAAK;AACzB;AAKA,SAAS,OAAO,OAAa;AAC3B,SAAO,KAAK,OAAO,KAAK;AAC1B;AAKA,SAAS,iBAAiB,SAAqB,YAAkB;AAC/D,QAAM,QAAkB,CAAA;AACxB,aAAW,QAAQ,SAAS;AAC1B,UAAM,cAAc,aAAa,KAAK;AACtC,UAAM,KAAK,GAAG,OAAO,WAAW,CAAC,KAAK,KAAK,OAAO,EAAE;EACtD;AACA,SAAO;AACT;AAKA,SAAS,cAAc,MAAY,aAAqB,GAAC;AACvD,QAAM,QAAkB,CAAA;AAGxB,QAAM,UAAU,WAAW,IAAI;AAC/B,QAAM,cAAc,UAAU,IAAI,OAAO,KAAK;AAC9C,QAAM,KAAK,GAAG,OAAO,UAAU,CAAC,OAAO,KAAK,WAAW,EAAE,KAAK,WAAW,EAAE;AAG3E,QAAM,KAAK,GAAG,OAAO,aAAa,CAAC,CAAC,KAAK,eAAe,KAAK,UAAU,CAAC,EAAE;AAG1E,QAAM,eAAe,iBAAiB,KAAK,SAAS,aAAa,CAAC;AAClE,QAAM,KAAK,GAAG,YAAY;AAG1B,MAAI,KAAK,SAAS,SAAS,GAAG;AAC5B,eAAW,SAAS,KAAK,UAAU;AACjC,YAAM,eAAe,WAAW,KAAK;AACrC,YAAM,mBAAmB,eAAe,IAAI,YAAY,KAAK;AAC7D,YAAM,KAAK,GAAG,OAAO,aAAa,CAAC,CAAC,OAAO,MAAM,WAAW,EAAE,KAAK,gBAAgB,EAAE;AACrF,YAAM,KAAK,GAAG,OAAO,aAAa,CAAC,CAAC,KAAK,eAAe,MAAM,UAAU,CAAC,EAAE;AAC3E,YAAM,oBAAoB,iBAAiB,MAAM,SAAS,aAAa,CAAC;AACxE,YAAM,KAAK,GAAG,iBAAiB;IACjC;EACF;AAEA,SAAO,MAAM,KAAK,IAAI;AACxB;AAKA,SAAS,YAAY,QAAc;AAEjC,SAAO;AACT;AAKA,SAAS,uBAAuB,aAAwB;AACtD,QAAM,QAAkB,CAAA;AAExB,QAAM,KAAK,mBAAmB;AAC9B,QAAM,KAAK,cAAc,YAAY,IAAI,EAAE;AAC3C,QAAM,KAAK,cAAc,YAAY,OAAO,EAAE;AAG9C,MAAI,YAAY,aAAa,SAAS,GAAG;AACvC,UAAM,KAAK,EAAE;AACb,UAAM,KAAK,iBAAiB;AAC5B,eAAW,QAAQ,YAAY,cAAc;AAC3C,YAAM,cAAc,IAAI,KAAK;AAC7B,YAAM,KAAK,GAAG,OAAO,WAAW,CAAC,KAAK,KAAK,OAAO,EAAE;IACtD;EACF;AAEA,SAAO,MAAM,KAAK,IAAI;AACxB;AAKA,SAAS,MAAM,aAAiC,OAAe,UAAwB,CAAA,GAAE;AACvF,QAAM,EAAE,YAAY,KAAI,IAAK;AAG7B,QAAM,gBAAgB,MAAM,OAAO,OAAK,CAAC,EAAE,WAAW,MAAM;AAG5D,QAAM,cAAc,CAAC,GAAG,aAAa;AACrC,MAAI,WAAW;AACb,gBAAY,KAAK,CAAC,GAAG,MAAK;AAExB,YAAM,QAAQ,EAAE,WAAW,QAAQ;AACnC,YAAM,QAAQ,EAAE,WAAW,QAAQ;AACnC,UAAI,UAAU,OAAO;AACnB,eAAO,MAAM,cAAc,KAAK;MAClC;AAEA,aAAO,EAAE,WAAW,GAAG,cAAc,EAAE,WAAW,EAAE;IACtD,CAAC;EACH;AAEA,QAAM,QAAkB,CAAA;AAGxB,MAAI,aAAa;AACf,UAAM,KAAK,uBAAuB,WAAW,CAAC;EAChD,OAAO;AACL,UAAM,KAAK,mBAAmB;EAChC;AAGA,QAAM,UAAU,iBAAiB,WAAW;AAC5C,QAAM,cAAc,CAAC,GAAG,QAAQ,KAAI,CAAE,EAAE,KAAI;AAE5C,aAAW,QAAQ,aAAa;AAC9B,UAAM,YAAY,QAAQ,IAAI,IAAI,KAAK,CAAA;AAGvC,UAAM,KAAK,EAAE;AACb,UAAM,KAAK,QAAQ,IAAI,EAAE;AAGzB,eAAW,QAAQ,WAAW;AAC5B,YAAM,KAAK,cAAc,MAAM,CAAC,CAAC;IACnC;EACF;AAEA,SAAO,MAAM,KAAK,IAAI,EAAE,KAAI,IAAK;AACnC;AAKM,SAAU,eAAY;AAC1B,SAAO;IACL;IACA;IACA;;AAEJ;;;AChNA,SAAoB;;;ACkBpB,IAAM,mBAAmB;AAKzB,SAAS,6BAA6B,SAAe;AACnD,QAAM,OAAiB,CAAA;AACvB,QAAM,QAAQ,IAAI,OAAO,iBAAiB,QAAQ,GAAG;AACrD,MAAI;AACJ,UAAQ,QAAQ,MAAM,KAAK,OAAO,OAAO,MAAM;AAC7C,UAAM,KAAK,MAAM,CAAC;AAClB,QAAI,CAAC,KAAK,SAAS,EAAE,GAAG;AACtB,WAAK,KAAK,EAAE;IACd;EACF;AACA,SAAO;AACT;AAKA,SAAS,qBAAqB,MAAU;AACtC,QAAM,OAAiB,CAAA;AAGvB,MAAI,KAAK,WAAW,SAAS;AAC3B,eAAW,OAAO,KAAK,WAAW,SAAS;AACzC,UAAI,CAAC,KAAK,SAAS,GAAG,GAAG;AACvB,aAAK,KAAK,GAAG;MACf;IACF;EACF;AAGA,aAAW,QAAQ,KAAK,SAAS;AAC/B,QAAI,KAAK,YAAY;AACnB,iBAAW,OAAO,KAAK,YAAY;AACjC,YAAI,CAAC,KAAK,SAAS,GAAG,GAAG;AACvB,eAAK,KAAK,GAAG;QACf;MACF;IACF;AAEA,UAAM,cAAc,6BAA6B,KAAK,OAAO;AAC7D,eAAW,OAAO,aAAa;AAC7B,UAAI,CAAC,KAAK,SAAS,GAAG,GAAG;AACvB,aAAK,KAAK,GAAG;MACf;IACF;EACF;AAEA,SAAO;AACT;AAKM,SAAU,wBAAqB;AAEnC,QAAM,eAAe,oBAAI,IAAG;AAE5B,QAAM,gBAAgB,oBAAI,IAAG;AAE7B,QAAM,aAAa,oBAAI,IAAG;AAK1B,WAAS,eAAe,QAAgB,MAAY;AAClD,UAAM,WAAW,aAAa,IAAI,MAAM,KAAK,CAAA;AAC7C,QAAI,CAAC,SAAS,SAAS,IAAI,GAAG;AAC5B,eAAS,KAAK,IAAI;AAClB,mBAAa,IAAI,QAAQ,QAAQ;IACnC;EACF;AAKA,WAAS,gBAAgB,QAAgB,MAAY;AACnD,UAAM,WAAW,cAAc,IAAI,IAAI,KAAK,CAAA;AAC5C,QAAI,CAAC,SAAS,SAAS,MAAM,GAAG;AAC9B,eAAS,KAAK,MAAM;AACpB,oBAAc,IAAI,MAAM,QAAQ;IAClC;EACF;AAKA,WAAS,kBAAkB,QAAgB,MAAY;AACrD,UAAM,WAAW,aAAa,IAAI,MAAM,KAAK,CAAA;AAC7C,UAAM,MAAM,SAAS,QAAQ,IAAI;AACjC,QAAI,QAAQ,IAAI;AACd,eAAS,OAAO,KAAK,CAAC;AACtB,mBAAa,IAAI,QAAQ,QAAQ;IACnC;EACF;AAKA,WAAS,mBAAmB,QAAgB,MAAY;AACtD,UAAM,WAAW,cAAc,IAAI,IAAI,KAAK,CAAA;AAC5C,UAAM,MAAM,SAAS,QAAQ,MAAM;AACnC,QAAI,QAAQ,IAAI;AACd,eAAS,OAAO,KAAK,CAAC;AACtB,oBAAc,IAAI,MAAM,QAAQ;IAClC;EACF;AAKA,WAAS,kBAAkB,IAAU;AAEnC,UAAM,WAAW,aAAa,IAAI,EAAE,KAAK,CAAA;AACzC,eAAW,QAAQ,UAAU;AAC3B,yBAAmB,IAAI,IAAI;IAC7B;AACA,iBAAa,OAAO,EAAE;AAGtB,UAAM,YAAY,cAAc,IAAI,EAAE,KAAK,CAAA;AAC3C,eAAW,UAAU,WAAW;AAC9B,wBAAkB,QAAQ,EAAE;IAC9B;AACA,kBAAc,OAAO,EAAE;EACzB;AAKA,WAAS,WAAW,OAAa;AAE/B,iBAAa,MAAK;AAClB,kBAAc,MAAK;AACnB,eAAW,MAAK;AAGhB,aAASC,cAAa,UAAgB;AACpC,iBAAW,QAAQ,UAAU;AAC3B,mBAAW,IAAI,KAAK,WAAW,EAAE;AACjC,YAAI,KAAK,SAAS,SAAS,GAAG;AAC5B,UAAAA,cAAa,KAAK,QAAQ;QAC5B;MACF;IACF;AACA,IAAAA,cAAa,KAAK;AAGlB,aAAS,aAAa,UAAgB;AACpC,iBAAW,QAAQ,UAAU;AAC3B,cAAM,OAAO,qBAAqB,IAAI;AACtC,mBAAW,SAAS,MAAM;AACxB,yBAAe,KAAK,WAAW,IAAI,KAAK;AACxC,0BAAgB,KAAK,WAAW,IAAI,KAAK;QAC3C;AAEA,YAAI,KAAK,SAAS,SAAS,GAAG;AAC5B,uBAAa,KAAK,QAAQ;QAC5B;MACF;IACF;AACA,iBAAa,KAAK;EACpB;AAMA,WAAS,cAAc,MAAY,YAAoB,aAAmB;AACxE,UAAM,SAAS,KAAK,WAAW;AAC/B,UAAM,WAAqB,CAAA;AAG3B,UAAM,UAAU,6BAA6B,UAAU;AACvD,UAAM,UAAU,qBAAqB,IAAI;AAGzC,eAAW,UAAU,SAAS;AAC5B,UAAI,CAAC,QAAQ,SAAS,MAAM,GAAG;AAC7B,0BAAkB,QAAQ,MAAM;AAChC,2BAAmB,QAAQ,MAAM;AACjC,YAAI,CAAC,SAAS,SAAS,MAAM,GAAG;AAC9B,mBAAS,KAAK,MAAM;QACtB;MACF;IACF;AAGA,eAAW,UAAU,SAAS;AAC5B,UAAI,CAAC,QAAQ,SAAS,MAAM,GAAG;AAC7B,uBAAe,QAAQ,MAAM;AAC7B,wBAAgB,QAAQ,MAAM;AAC9B,YAAI,CAAC,SAAS,SAAS,MAAM,GAAG;AAC9B,mBAAS,KAAK,MAAM;QACtB;MACF;IACF;AAEA,WAAO;EACT;AAMA,WAAS,WAAW,IAAU;AAC5B,UAAM,WAAqB,CAAA;AAG3B,UAAM,WAAW,aAAa,IAAI,EAAE,KAAK,CAAA;AACzC,UAAM,YAAY,cAAc,IAAI,EAAE,KAAK,CAAA;AAE3C,eAAW,SAAS,UAAU;AAC5B,UAAI,CAAC,SAAS,SAAS,KAAK,GAAG;AAC7B,iBAAS,KAAK,KAAK;MACrB;IACF;AACA,eAAW,SAAS,WAAW;AAC7B,UAAI,CAAC,SAAS,SAAS,KAAK,GAAG;AAC7B,iBAAS,KAAK,KAAK;MACrB;IACF;AAGA,sBAAkB,EAAE;AACpB,eAAW,OAAO,EAAE;AAEpB,WAAO;EACT;AAKA,WAAS,eAAY;AACnB,UAAM,QAAQ,CAAC,GAAG,UAAU;AAC5B,UAAM,QAAoB,CAAA;AAE1B,eAAW,CAAC,QAAQ,KAAK,KAAK,cAAc;AAC1C,iBAAW,QAAQ,OAAO;AACxB,cAAM,KAAK,EAAE,MAAM,QAAQ,IAAI,KAAI,CAAE;MACvC;IACF;AAEA,WAAO,EAAE,OAAO,MAAK;EACvB;AAKA,WAAS,gBAAgB,IAAU;AACjC,WAAO,aAAa,IAAI,EAAE,KAAK,CAAA;EACjC;AAKA,WAAS,iBAAiB,IAAU;AAClC,WAAO,cAAc,IAAI,EAAE,KAAK,CAAA;EAClC;AAKA,WAAS,iBAAiB,IAAU;AAClC,YAAQ,cAAc,IAAI,EAAE,KAAK,CAAA,GAAI;EACvC;AAEA,SAAO;IACL;IACA;IACA;IACA;IACA;IACA;IACA;;AAEJ;;;ADxOA,SAAS,oBAAiB;AACxB,QAAM,QAAQ;AACd,MAAI,OAAO;AACX,WAAS,IAAI,GAAG,IAAI,GAAG,KAAK;AAC1B,YAAQ,MAAM,KAAK,MAAM,KAAK,OAAM,IAAK,MAAM,MAAM,CAAC;EACxD;AACA,SAAO,MAAM,IAAI;AACnB;AAKM,SAAU,gBAAgB,cAAsB,UAA4B,CAAA,GAAE;AAClF,QAAM,EAAE,YAAAC,cAAa,mBAAmB,WAAW,KAAI,IAAK;AAG5D,MAAI,cAAkC;AACtC,MAAI,WAA8B,oBAAI,IAAG;AACzC,MAAI,cAAkC;AACtC,MAAI,kBAAmC,sBAAqB;AAC5D,MAAI,UAAU;AAGd,QAAM,SAAS,aAAY;AAC3B,QAAM,SAAS,aAAY;AAK3B,WAAS,OAAI;AACX,QAAI,CAAI,cAAW,YAAY,GAAG;AAEhC,oBAAc;AACd,iBAAW,oBAAI,IAAG;AAClB,oBAAc;AACd,wBAAkB,sBAAqB;AACvC;IACF;AAEA,UAAM,UAAa,gBAAa,cAAc,OAAO;AACrD,kBAAc,OAAO,MAAM,OAAO;AAClC,kBAAc,YAAY;AAC1B,eAAW,YAAY;AAGvB,UAAM,WAAW,oBAAmB;AACpC,oBAAgB,WAAW,QAAQ;EACrC;AAKA,WAAS,sBAAmB;AAC1B,UAAM,MAAc,CAAA;AACpB,aAAS,QAAQ,OAAa;AAC5B,iBAAW,QAAQ,OAAO;AACxB,YAAI,KAAK,IAAI;AACb,YAAI,KAAK,SAAS,SAAS,GAAG;AAC5B,kBAAQ,KAAK,QAAQ;QACvB;MACF;IACF;AACA,YAAQ,MAAM,KAAK,SAAS,OAAM,CAAE,EAAE,OAAO,OAAK,CAAC,EAAE,WAAW,MAAM,CAAC;AACvE,WAAO;EACT;AAKA,WAAS,mBAAgB;AACvB,WAAO,MAAM,KAAK,SAAS,OAAM,CAAE,EAAE,OAAO,OAAK,CAAC,EAAE,WAAW,MAAM;EACvE;AAKA,WAAS,aAAU;AACjB,UAAM,gBAAgB,iBAAgB;AACtC,UAAM,UAAU,OAAO,MAAM,aAAa,aAAa;AAGvD,UAAM,WAAW,eAAe;AAChC,IAAG,iBAAc,UAAU,SAAS,OAAO;AAC3C,IAAG,cAAW,UAAU,YAAY;AACpC,cAAU;EACZ;AAKA,WAAS,YAAS;AAChB,cAAU;AACV,QAAI,UAAU;AACZ,iBAAU;IACZ;EACF;AAKA,WAAS,iBAAiB,MAAc,IAAY,UAAiB;AACnE,UAAM,SAAS,GAAG,QAAQ,OAAO,EAAE;AACnC,QAAI,UAAU;AACZ,YAAM,aAAa,SAAS,QAAQ,OAAO,EAAE;AAC7C,aAAO,GAAG,IAAI,IAAI,UAAU,IAAI,MAAM;IACxC;AACA,WAAO,GAAG,IAAI,IAAI,MAAM;EAC1B;AAKA,WAAS,uBAAoB;AAC3B,eAAW,CAAC,IAAI,IAAI,KAAK,UAAU;AACjC,YAAM,QAAQ,gBAAgB,iBAAiB,EAAE;AACjD,UAAI,QAAQ,GAAG;AACb,aAAK,WAAW,iBAAiB;AACjC,aAAK,WAAW,YAAY,gBAAgB,iBAAiB,EAAE;MACjE,OAAO;AACL,eAAO,KAAK,WAAW;AACvB,eAAO,KAAK,WAAW;MACzB;IACF;EACF;AAGA,OAAI;AAGJ,SAAO;;IAGL,QAAQ,IAAU;AAChB,aAAO,SAAS,IAAI,EAAE,KAAK;IAC7B;IAEA,cAAc,UAAkB;AAC9B,iBAAW,QAAQ,SAAS,OAAM,GAAI;AACpC,YAAI,KAAK,gBAAgB,UAAU;AACjC,iBAAO;QACT;MACF;AACA,aAAO;IACT;IAEA,cAAW;AACT,aAAO,MAAM,KAAK,SAAS,OAAM,CAAE;IACrC;IAEA,eAAe,MAAY;AACzB,aAAO,MAAM,KAAK,SAAS,OAAM,CAAE,EAAE,OAAO,OAAK,EAAE,WAAW,SAAS,IAAI;IAC7E;IAEA,YAAY,UAAgB;AAC1B,YAAM,SAAS,SAAS,IAAI,QAAQ;AACpC,aAAO,SAAS,OAAO,WAAW,CAAA;IACpC;;IAIA,aAAa,IAAU;AACrB,YAAM,cAAc,gBAAgB,iBAAiB,EAAE;AACvD,aAAO,YAAY,IAAI,SAAO,SAAS,IAAI,GAAG,CAAC,EAAE,OAAO,CAAC,MAAiB,MAAM,MAAS;IAC3F;IAEA,WAAW,IAAY,QAAgB,GAAC;AACtC,YAAM,SAAwB,CAAA;AAC9B,YAAM,UAAU,oBAAI,IAAY,CAAC,EAAE,CAAC;AAEpC,eAAS,SACP,WACA,cACA,WAAkC;AAElC,YAAI,eAAe;AAAO;AAE1B,cAAM,QACJ,cAAc,aACV,gBAAgB,gBAAgB,SAAS,IACzC,gBAAgB,iBAAiB,SAAS;AAEhD,mBAAW,YAAY,OAAO;AAC5B,cAAI,QAAQ,IAAI,QAAQ;AAAG;AAC3B,kBAAQ,IAAI,QAAQ;AAEpB,gBAAM,OAAO,SAAS,IAAI,QAAQ;AAClC,cAAI,MAAM;AACR,mBAAO,KAAK,EAAE,MAAM,WAAW,OAAO,aAAY,CAAE;AACpD,qBAAS,UAAU,eAAe,GAAG,SAAS;UAChD;QACF;MACF;AAEA,eAAS,IAAI,GAAG,UAAU;AAC1B,eAAS,IAAI,GAAG,UAAU;AAE1B,aAAO;IACT;IAEA,aAAU;AACR,aAAO,MAAM,KAAK,SAAS,OAAM,CAAE,EAAE,OAAO,UAAO;AACjD,cAAM,KAAK,KAAK,WAAW;AAC3B,cAAM,eAAe,gBAAgB,iBAAiB,EAAE,IAAI;AAC5D,cAAM,kBAAkB,gBAAgB,gBAAgB,EAAE,EAAE,SAAS;AACrE,eAAO,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,KAAK,WAAW;MAC/D,CAAC;IACH;IAEA,WAAW,QAAgB,IAAE;AAC3B,YAAM,kBAAkB,MAAM,KAAK,SAAS,OAAM,CAAE,EACjD,IAAI,WAAS;QACZ;QACA,OAAO,gBAAgB,iBAAiB,KAAK,WAAW,EAAE;QAC1D,EACD,OAAO,UAAQ,KAAK,QAAQ,CAAC,EAC7B,KAAK,CAAC,GAAG,MAAM,EAAE,QAAQ,EAAE,KAAK;AAEnC,aAAO,gBAAgB,MAAM,GAAG,KAAK,EAAE,IAAI,UAAQ,KAAK,IAAI;IAC9D;;IAIA,OAAO,OAAe,QAAgB,IAAE;AACtC,YAAM,UAA0B,CAAA;AAChC,YAAM,aAAa,MAAM,YAAW;AACpC,YAAM,aAAa,WAAW,MAAM,KAAK,EAAE,OAAO,OAAK,EAAE,SAAS,CAAC;AAEnE,iBAAW,QAAQ,SAAS,OAAM,GAAI;AACpC,cAAM,UAAyB,CAAA;AAC/B,YAAI,QAAQ;AAGZ,aAAK,QAAQ,QAAQ,CAAC,MAAM,YAAW;AACrC,gBAAM,eAAe,KAAK,QAAQ,YAAW;AAE7C,qBAAW,QAAQ,YAAY;AAC7B,kBAAM,MAAM,aAAa,QAAQ,IAAI;AACrC,gBAAI,QAAQ,IAAI;AACd,sBAAQ,KAAK;gBACX,MAAM;gBACN,SAAS,KAAK;gBACd,WAAW,CAAC,KAAK,MAAM,KAAK,MAAM;eACnC;AACD,uBAAS;AAGT,kBAAI,iBAAiB,MAAM;AACzB,yBAAS;cACX;YACF;UACF;QACF,CAAC;AAED,YAAI,eAAe;AAGnB,YAAI,KAAK,WAAW,MAAM;AACxB,gBAAM,YAAY,KAAK,WAAW,KAAK,YAAW;AAClD,qBAAW,QAAQ,YAAY;AAC7B,gBAAI,UAAU,SAAS,IAAI,GAAG;AAC5B,uBAAS;AACT,6BAAe;YACjB;UACF;QACF;AAGA,cAAM,YAAY,KAAK,YAAY,YAAW;AAC9C,mBAAW,QAAQ,YAAY;AAC7B,cAAI,UAAU,SAAS,IAAI,GAAG;AAC5B,qBAAS;AACT,2BAAe;UACjB;QACF;AAGA,YAAI,QAAQ,SAAS,KAAK,cAAc;AACtC,mBAAS,gBAAgB,iBAAiB,KAAK,WAAW,EAAE,IAAI;QAClE;AAEA,YAAI,QAAQ,SAAS,KAAK,cAAc;AACtC,kBAAQ,KAAK,EAAE,MAAM,SAAS,MAAK,CAAE;QACvC;MACF;AAGA,cAAQ,KAAK,CAAC,GAAG,MAAM,EAAE,QAAQ,EAAE,KAAK;AAExC,aAAO,QAAQ,MAAM,GAAG,KAAK;IAC/B;;IAIA,QAAQ,MAAc,SAAiB,UAAmB,QAAe;AAEvE,UAAI;AACJ,UAAI,UAAU,CAAC,SAAS,IAAI,MAAM,GAAG;AACnC,gBAAQ;MACV,OAAO;AACL,WAAG;AACD,kBAAQA,YAAU;QACpB,SAAS,SAAS,IAAI,KAAK;MAC7B;AAGA,YAAM,aAA6B;QACjC,IAAI;QACJ;QACA,QAAQ;QACR,UAAS,oBAAI,KAAI,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,KAAK;;AAGrD,UAAI,UAAU;AACZ,mBAAW,SAAS;MACtB;AAGA,YAAM,eAA2B,QAAQ,MAAM,IAAI,EAAE,IAAI,WAAS;QAChE,QAAQ;QACR,SAAS;QACT;AAGF,YAAM,cAAc,iBAAiB,MAAM,OAAO,QAAQ;AAC1D,YAAM,UAAgB;QACpB;QACA,SAAS;QACT,UAAU,CAAA;QACV;;AAIF,eAAS,IAAI,OAAO,OAAO;AAG3B,UAAI,UAAU;AACZ,cAAM,SAAS,SAAS,IAAI,QAAQ;AACpC,YAAI,QAAQ;AACV,iBAAO,SAAS,KAAK,OAAO;QAC9B;MACF;AAGA,sBAAgB,cAAc,SAAS,IAAI,OAAO;AAClD,2BAAoB;AAEpB,gBAAS;AACT,aAAO;IACT;IAEA,WAAW,IAAY,SAAe;AACpC,YAAM,OAAO,SAAS,IAAI,EAAE;AAC5B,UAAI,CAAC,MAAM;AACT,cAAM,IAAI,MAAM,mBAAmB,EAAE,EAAE;MACzC;AAGA,YAAM,aAAa,KAAK,QAAQ,IAAI,OAAK,EAAE,OAAO,EAAE,KAAK,IAAI;AAG7D,YAAM,eAA2B,QAAQ,MAAM,IAAI,EAAE,IAAI,WAAS;QAChE,QAAQ;QACR,SAAS;QACT;AACF,WAAK,UAAU;AAGf,sBAAgB,cAAc,MAAM,YAAY,OAAO;AACvD,2BAAoB;AAEpB,gBAAS;AACT,aAAO;IACT;IAEA,WAAW,IAAU;AACnB,YAAM,OAAO,SAAS,IAAI,EAAE;AAC5B,UAAI,CAAC,MAAM;AACT,cAAM,IAAI,MAAM,mBAAmB,EAAE,EAAE;MACzC;AAGA,iBAAW,SAAS,KAAK,UAAU;AACjC,aAAK,WAAW,MAAM,WAAW,EAAE;MACrC;AAGA,UAAI,KAAK,WAAW,QAAQ;AAC1B,cAAM,SAAS,SAAS,IAAI,KAAK,WAAW,MAAM;AAClD,YAAI,QAAQ;AACV,iBAAO,WAAW,OAAO,SAAS,OAAO,OAAK,EAAE,WAAW,OAAO,EAAE;QACtE;MACF;AAGA,sBAAgB,WAAW,EAAE;AAG7B,eAAS,OAAO,EAAE;AAElB,2BAAoB;AACpB,gBAAS;IACX;IAEA,SAAS,IAAY,SAAiB,SAAgB;AACpD,YAAM,OAAO,SAAS,IAAI,EAAE;AAC5B,UAAI,CAAC,MAAM;AACT,cAAM,IAAI,MAAM,mBAAmB,EAAE,EAAE;MACzC;AAGA,WAAK,WAAW,OAAO;AACvB,UAAI,YAAY,QAAW;AACzB,aAAK,WAAW,OAAO;MACzB;AAGA,WAAK,cAAc,iBAAiB,SAAS,IAAI,KAAK,WAAW,MAAM;AAGvE,eAAS,mBAAmB,YAAgB;AAC1C,mBAAW,SAAS,WAAW,UAAU;AACvC,gBAAM,WAAW,OAAO;AACxB,gBAAM,cAAc,iBAClB,SACA,MAAM,WAAW,IACjB,WAAW,WAAW,EAAE;AAE1B,6BAAmB,KAAK;QAC1B;MACF;AACA,yBAAmB,IAAI;AAEvB,gBAAS;AACT,aAAO;IACT;;IAIA,SAAM;AACJ,WAAI;IACN;IAEA,OAAI;AACF,UAAI,WAAW,CAAC,UAAU;AACxB,mBAAU;MACZ;IACF;;IAIA,iBAAc;AACZ,aAAO;IACT;IAEA,iBAAc;AACZ,aAAO;IACT;;AAEJ;;;AE1eA,IAAM,mBAAmB;AAKzB,IAAM,aAAa;AAKnB,IAAM,cAAc;AAKd,SAAU,kBAAkB,UAA8B,CAAA,GAAE;AAChE,QAAM,EAAE,WAAW,GAAG,WAAW,kBAAkB,WAAW,KAAK,OAAM,IAAK;AAK9E,WAAS,eAAY;AACnB,QAAI,OAAO;AACX,aAAS,IAAI,GAAG,IAAI,UAAU,KAAK;AACjC,YAAM,MAAM,KAAK,MAAM,SAAQ,IAAK,SAAS,MAAM;AACnD,cAAQ,SAAS,GAAG;IACtB;AACA,WAAO;EACT;AAKA,WAASC,cAAU;AACjB,WAAO,MAAM,aAAY,CAAE;EAC7B;AAKA,WAASC,kBAAiB,aAAwB;AAChD,QAAI;AACJ,QAAI,WAAW;AACf,UAAM,cAAc;AAEpB,OAAG;AACD,WAAKD,YAAU;AACf;AAEA,UAAI,YAAY,aAAa;AAC3B,cAAM,IAAI,MAAM,qDAAqD;MACvE;IACF,SAAS,YAAY,IAAI,EAAE;AAE3B,WAAO;EACT;AAKA,WAASE,WAAU,IAAU;AAC3B,WAAO,WAAW,KAAK,EAAE;EAC3B;AAKA,WAASC,qBAAoB,MAAc,IAAY,UAAiB;AACtE,UAAM,SAAS,GAAG,QAAQ,OAAO,EAAE;AAEnC,QAAI,UAAU;AACZ,YAAM,aAAa,SAAS,QAAQ,OAAO,EAAE;AAC7C,aAAO,GAAG,IAAI,IAAI,UAAU,IAAI,MAAM;IACxC;AAEA,WAAO,GAAG,IAAI,IAAI,MAAM;EAC1B;AAMA,WAASC,kBAAiB,KAAW;AACnC,UAAM,QAAQ,IAAI,MAAM,WAAW;AACnC,QAAI,SAAS,MAAM,CAAC,GAAG;AACrB,aAAO,MAAM,CAAC;IAChB;AACA,WAAO;EACT;AAKA,WAASC,kBACP,aAAqB;AAErB,UAAM,QAAQ,YAAY,MAAM,GAAG;AAEnC,QAAI,MAAM,SAAS,GAAG;AACpB,aAAO;IACT;AAGA,QAAI,MAAM,WAAW,GAAG;AACtB,aAAO;QACL,MAAM,MAAM,CAAC,KAAK;QAClB,IAAI,MAAM,CAAC,KAAK;;IAEpB;AAEA,QAAI,MAAM,UAAU,GAAG;AAErB,YAAM,KAAK,MAAM,MAAM,SAAS,CAAC,KAAK;AACtC,YAAM,WAAW,MAAM,MAAM,SAAS,CAAC,KAAK;AAC5C,YAAM,OAAO,MAAM,MAAM,GAAG,MAAM,SAAS,CAAC,EAAE,KAAK,GAAG;AAEtD,aAAO;QACL;QACA;QACA;;IAEJ;AAEA,WAAO;EACT;AAEA,SAAO;IACL,YAAAL;IACA,kBAAAC;IACA,WAAAC;IACA,qBAAAC;IACA,kBAAAC;IACA,kBAAAC;;AAEJ;AAGA,IAAM,mBAAmB,kBAAiB;AAEnC,IAAM,aAAa,iBAAiB;AACpC,IAAM,mBAAmB,iBAAiB;AAC1C,IAAM,YAAY,iBAAiB;AACnC,IAAM,sBAAsB,iBAAiB;AAC7C,IAAM,mBAAmB,iBAAiB;AAC1C,IAAM,mBAAmB,iBAAiB;;;ALzKjD,IAAM,iBAAN,MAAqB;AAAA,EACX,QAA0B;AAAA,EAC1B,eAA8B;AAAA,EAC9B,UAA2C;AAAA,EAC3C,eAAe,IAAW,oBAAmB;AAAA,EAC5C,cAAc,KAAK,aAAa;AAAA;AAAA;AAAA;AAAA,EAKzC,MAAM,aAA+B;AACnC,UAAM,mBAA0B,iBAAU;AAC1C,QAAI,CAAC,oBAAoB,iBAAiB,WAAW,GAAG;AACtD,aAAO;AAAA,IACT;AAGA,eAAW,UAAU,kBAAkB;AACrC,YAAM,eAAoB,UAAK,OAAO,IAAI,QAAQ,aAAa;AAC/D,UAAI;AACF,cAAa,iBAAU,GAAG,KAAY,WAAI,KAAK,YAAY,CAAC;AAC5D,aAAK,eAAe;AACpB;AAAA,MACF,QAAQ;AAAA,MAER;AAAA,IACF;AAEA,QAAI,CAAC,KAAK,cAAc;AACtB,aAAO;AAAA,IACT;AAGA,SAAK,QAAQ,gBAAgB,KAAK,cAAc,EAAE,UAAU,KAAK,CAAC;AAGlE,UAAM,WAAW,KAAK,MAAM,YAAY;AACxC,YAAQ,IAAI,qCAAqC,SAAS,MAAM,eAAe,KAAK,YAAY,EAAE;AAClG,QAAI,SAAS,SAAS,GAAG;AACvB,cAAQ,IAAI,sCAAsC,SAAS,MAAM,GAAG,CAAC,EAAE,IAAI,OAAK,EAAE,WAAW,EAAE,CAAC;AAAA,IAClG;AAGA,SAAK,UAAiB,iBAAU,wBAAwB,KAAK,YAAY;AACzE,SAAK,QAAQ,YAAY,MAAM,KAAK,OAAO,CAAC;AAC5C,SAAK,QAAQ,YAAY,MAAM,KAAK,OAAO,CAAC;AAC5C,SAAK,QAAQ,YAAY,MAAM,KAAK,QAAQ,CAAC;AAE7C,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,SAAe;AACb,QAAI,KAAK,cAAc;AACrB,WAAK,QAAQ,gBAAgB,KAAK,cAAc,EAAE,UAAU,KAAK,CAAC;AAClE,WAAK,aAAa,KAAK;AAAA,IACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAA6B;AAC3B,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAiC;AAC/B,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,cAAsB;AACpB,WAAO,KAAK,OAAO,YAAY,KAAK,CAAC;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,IAAyB;AAC/B,WAAO,KAAK,OAAO,QAAQ,EAAE,KAAK;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,UAA0B;AACvC,WAAO,KAAK,OAAO,eAAe,QAAQ,KAAK,CAAC;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,IAAoB;AAC/B,WAAO,KAAK,OAAO,aAAa,EAAE,KAAK,CAAC;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,OAAe,QAAgB,IAAI;AACxC,WAAO,KAAK,OAAO,OAAO,OAAO,KAAK,KAAK,CAAC;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,MAAc,SAAiB,UAAgC;AACrE,UAAM,OAAO,KAAK,OAAO,QAAQ,MAAM,SAAS,QAAQ;AACxD,QAAI,MAAM;AACR,WAAK,aAAa,KAAK;AAAA,IACzB;AACA,WAAO,QAAQ;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,UAAgB;AACd,SAAK,SAAS,QAAQ;AACtB,SAAK,UAAU;AACf,SAAK,QAAQ;AACb,SAAK,eAAe;AAAA,EACtB;AACF;AAGO,IAAM,iBAAiB,IAAI,eAAe;AAK1C,IAAM,yBAAyB;AAK/B,SAAS,2BACd,UACA,UACkE;AAClE,QAAM,OAAO,SAAS,OAAO,SAAS,IAAI;AAC1C,QAAM,OAAO,KAAK;AAGlB,QAAM,UAAU,IAAI,OAAO,uBAAuB,QAAQ,GAAG;AAC7D,MAAI;AAEJ,UAAQ,QAAQ,QAAQ,KAAK,IAAI,OAAO,MAAM;AAC5C,UAAM,WAAW,MAAM;AACvB,UAAM,SAAS,MAAM,QAAQ,MAAM,CAAC,EAAE;AAEtC,QAAI,SAAS,aAAa,YAAY,SAAS,aAAa,QAAQ;AAClE,YAAM,SAAoE;AAAA,QACxE,IAAI,MAAM,CAAC;AAAA,QACX,OAAO,IAAW,aAAM,SAAS,MAAM,UAAU,SAAS,MAAM,MAAM;AAAA,MACxE;AACA,UAAI,MAAM,CAAC,MAAM,QAAW;AAC1B,eAAO,cAAc,MAAM,CAAC;AAAA,MAC9B;AACA,aAAO;AAAA,IACT;AAAA,EACF;AAEA,SAAO;AACT;AAKA,eAAsB,0BAA0B,IAA6C;AAC3F,QAAM,eAAe,eAAe,gBAAgB;AACpD,MAAI,CAAC,aAAc,QAAO;AAE1B,QAAM,MAAa,WAAI,KAAK,YAAY;AACxC,MAAI;AACF,UAAM,WAAW,MAAa,iBAAU,iBAAiB,GAAG;AAC5D,UAAM,OAAO,SAAS,QAAQ;AAG9B,UAAM,UAAU,IAAI,OAAO,mBAAmB,EAAE,yBAAyB,GAAG;AAC5E,UAAM,QAAQ,QAAQ,KAAK,IAAI;AAE/B,QAAI,OAAO;AACT,YAAM,MAAM,SAAS,WAAW,MAAM,KAAK;AAC3C,aAAO,IAAW,gBAAS,KAAK,GAAG;AAAA,IACrC;AAAA,EACF,QAAQ;AAAA,EAER;AAEA,SAAO;AACT;AAKA,eAAsB,mBAAmB,IAAwC;AAC/E,QAAM,YAA+B,CAAC;AACtC,QAAM,UAAU,IAAI,OAAO,SAAS,EAAE,yBAAyB,GAAG;AAGlE,QAAM,QAAQ,MAAa,iBAAU,UAAU,2BAA2B,oBAAoB;AAE9F,aAAW,QAAQ,OAAO;AACxB,QAAI;AACF,YAAM,WAAW,MAAa,iBAAU,iBAAiB,IAAI;AAC7D,YAAM,OAAO,SAAS,QAAQ;AAC9B,UAAI;AAEJ,cAAQ,QAAQ,QAAQ,KAAK,IAAI,OAAO,MAAM;AAC5C,cAAM,MAAM,SAAS,WAAW,MAAM,KAAK;AAC3C,kBAAU,KAAK,IAAW,gBAAS,MAAM,GAAG,CAAC;AAAA,MAC/C;AAAA,IACF,QAAQ;AAAA,IAER;AAAA,EACF;AAEA,SAAO;AACT;AAKO,SAAS,oBAAoB,UAA0B;AAC5D,QAAM,kBAAyB,iBAAU,mBAAmB,CAAC;AAC7D,MAAI,iBAAiB;AACnB,WAAY,cAAS,gBAAgB,IAAI,QAAQ,QAAQ;AAAA,EAC3D;AACA,SAAO;AACT;;;AMrPA,IAAAC,UAAwB;AAOjB,IAAM,yBAAN,MAAsE;AAAA,EAC3E,uBACE,UACA,UACA,QACA,UACwE;AAExE,UAAM,aAAa,SAAS,OAAO,QAAQ,EAAE,KAAK,UAAU,GAAG,SAAS,SAAS;AACjF,QAAI,CAAC,WAAW,SAAS,IAAI,GAAG;AAC9B,aAAO,CAAC;AAAA,IACV;AAGA,UAAM,eAAe,WAAW,YAAY,IAAI;AAChD,QAAI,iBAAiB,IAAI;AACvB,aAAO,CAAC;AAAA,IACV;AAGA,UAAM,aAAa,WAAW,UAAU,eAAe,CAAC;AAGxD,QAAI,WAAW,SAAS,IAAI,GAAG;AAC7B,aAAO,CAAC;AAAA,IACV;AAEA,UAAM,QAAiC,CAAC;AACxC,UAAM,QAAQ,eAAe,YAAY;AACzC,UAAM,cAAc,oBAAoB,SAAS,IAAI,MAAM;AAG3D,UAAM,cAAc,CAAC,GAAG,KAAK,EAAE,KAAK,CAAC,GAAG,MAAM;AAC5C,YAAM,iBAAiB,EAAE,WAAW,SAAS;AAC7C,YAAM,iBAAiB,EAAE,WAAW,SAAS;AAE7C,UAAI,kBAAkB,CAAC,eAAgB,QAAO;AAC9C,UAAI,CAAC,kBAAkB,eAAgB,QAAO;AAG9C,cAAQ,EAAE,WAAW,kBAAkB,MAAM,EAAE,WAAW,kBAAkB;AAAA,IAC9E,CAAC;AAGD,aAAS,IAAI,GAAG,IAAI,YAAY,QAAQ,KAAK;AAC3C,YAAM,OAAO,YAAY,CAAC;AAG1B,UAAI,cAAc,CAAC,KAAK,YAAY,YAAY,EAAE,SAAS,WAAW,YAAY,CAAC,GAAG;AACpF;AAAA,MACF;AAEA,YAAM,OAAO,IAAW,uBAAe,KAAK,aAAoB,2BAAmB,SAAS;AAG5F,WAAK,aAAa,GAAG,KAAK,WAAW,EAAE,IAAI,KAAK,WAAW;AAG3D,YAAM,QAAQ,IAAW;AAAA,QACvB,SAAS;AAAA,QACT,eAAe;AAAA,QACf,SAAS;AAAA,QACT,SAAS;AAAA,MACX;AACA,WAAK,QAAQ;AAGb,YAAM,UAAU,KAAK,QAAQ,CAAC,GAAG,WAAW;AAC5C,WAAK,SAAS,GAAG,KAAK,WAAW,QAAQ,SAAS,MAAM,KAAK,WAAW,MAAM;AAC9E,WAAK,gBAAgB,IAAW;AAAA,QAC9B,KAAK,KAAK,WAAW;AAAA;AAAA,EAAS,OAAO;AAAA;AAAA,eAAoB,KAAK,WAAW,kBAAkB,CAAC;AAAA,MAC9F;AAGA,WAAK,WAAW,OAAO,CAAC,EAAE,SAAS,GAAG,GAAG;AAGzC,UAAI,KAAK,WAAW,SAAS,aAAa;AACxC,aAAK,QAAQ,UAAK,KAAK,WAAW;AAAA,MACpC;AAEA,YAAM,KAAK,IAAI;AAAA,IACjB;AAGA,QAAI,cAAc,WAAW,SAAS,GAAG;AACvC,YAAM,aAAa,IAAW;AAAA,QAC5B,YAAY,UAAU;AAAA,QACf,2BAAmB;AAAA,MAC5B;AACA,iBAAW,aAAa,aAAa,UAAU;AAC/C,iBAAW,QAAQ,IAAW;AAAA,QAC5B,SAAS;AAAA,QACT;AAAA,QACA,SAAS;AAAA,QACT,SAAS;AAAA,MACX;AACA,iBAAW,SAAS;AACpB,iBAAW,gBAAgB,IAAW;AAAA,QACpC;AAAA,MACF;AACA,iBAAW,WAAW;AACtB,YAAM,KAAK,UAAU;AAAA,IACvB;AAEA,WAAO;AAAA,EACT;AACF;;;AClHA,IAAAC,UAAwB;AAOxB,IAAM,aAAa,oBAAI,IAAmE;AAC1F,IAAM,YAAY;AAMX,IAAM,oBAAN,MAAwD;AAAA,EAC7D,aACE,UACA,UACA,QACqC;AAErC,UAAM,MAAM,2BAA2B,UAAU,QAAQ;AACzD,QAAI,CAAC,KAAK;AACR,aAAO;AAAA,IACT;AAGA,UAAM,SAAS,WAAW,IAAI,IAAI,EAAE;AACpC,QAAI,UAAU,KAAK,IAAI,IAAI,OAAO,YAAY,WAAW;AACvD,aAAO,IAAW,cAAM,OAAO,SAAS,IAAI,KAAK;AAAA,IACnD;AAGA,UAAM,OAAO,eAAe,QAAQ,IAAI,EAAE;AAC1C,QAAI,CAAC,MAAM;AACT,YAAM,WAAW,IAAW;AAAA,QAC1B,yBAAyB,IAAI,EAAE;AAAA;AAAA;AAAA,MACjC;AACA,aAAO,IAAW,cAAM,UAAU,IAAI,KAAK;AAAA,IAC7C;AAGA,UAAM,UAAU,kBAAkB,IAAI,IAAI,IAAI;AAG9C,eAAW,IAAI,IAAI,IAAI,EAAE,SAAS,WAAW,KAAK,IAAI,EAAE,CAAC;AAEzD,WAAO,IAAW,cAAM,SAAS,IAAI,KAAK;AAAA,EAC5C;AACF;AAKA,SAAS,kBACP,IACA,MAWuB;AACvB,QAAM,KAAK,IAAW,uBAAe;AACrC,KAAG,YAAY;AACf,KAAG,cAAc;AAGjB,KAAG,eAAe,iBAAU,KAAK,WAAW;AAAA;AAAA,CAAM;AAGlD,KAAG,eAAe,mCAAmC;AACrD,KAAG,eAAe,gBAAgB,EAAE;AAAA,CAAQ;AAC5C,MAAI,KAAK,WAAW,MAAM;AACxB,OAAG,eAAe,gBAAgB,KAAK,WAAW,IAAI;AAAA,CAAM;AAAA,EAC9D;AACA,MAAI,KAAK,WAAW,MAAM;AACxB,OAAG,eAAe,gBAAgB,KAAK,WAAW,IAAI;AAAA,CAAM;AAAA,EAC9D;AACA,MAAI,KAAK,WAAW,QAAQ;AAC1B,OAAG,eAAe,kBAAkB,KAAK,WAAW,MAAM;AAAA,CAAM;AAAA,EAClE;AACA,MAAI,KAAK,WAAW,SAAS;AAC3B,OAAG,eAAe,mBAAmB,KAAK,WAAW,OAAO;AAAA,CAAM;AAAA,EACpE;AACA,KAAG,eAAe,IAAI;AAGtB,MAAI,KAAK,QAAQ,SAAS,GAAG;AAC3B,OAAG,eAAe,kBAAkB;AACpC,UAAM,WAAW;AACjB,UAAM,QAAQ,KAAK,QAAQ,MAAM,GAAG,QAAQ;AAC5C,eAAW,QAAQ,OAAO;AACxB,YAAMC,UAAS,KAAK,OAAO,KAAK,MAAM;AACtC,SAAG,eAAe,GAAGA,OAAM,KAAK,KAAK,OAAO;AAAA,CAAI;AAAA,IAClD;AACA,QAAI,KAAK,QAAQ,SAAS,UAAU;AAClC,SAAG,eAAe;AAAA,WAAc,KAAK,QAAQ,SAAS,QAAQ;AAAA,CAAgB;AAAA,IAChF;AACA,OAAG,eAAe,IAAI;AAAA,EACxB;AAGA,QAAM,YAAY,eAAe,aAAa,EAAE;AAChD,MAAI,UAAU,SAAS,GAAG;AACxB,OAAG,eAAe,sBAAsB,UAAU,MAAM;AAAA;AAAA,CAAc;AACtE,UAAM,eAAe;AACrB,eAAW,MAAM,UAAU,MAAM,GAAG,YAAY,GAAG;AACjD,SAAG,eAAe,SAAS,GAAG,WAAW,EAAE,QAAQ,GAAG,WAAW;AAAA,CAAI;AAAA,IACvE;AACA,QAAI,UAAU,SAAS,cAAc;AACnC,SAAG,eAAe,cAAc,UAAU,SAAS,YAAY;AAAA,CAAU;AAAA,IAC3E;AAAA,EACF,OAAO;AACL,OAAG,eAAe,mCAAmC;AAAA,EACvD;AAGA,KAAG,eAAe,SAAS;AAC3B,KAAG;AAAA,IACD,gDAAgD,mBAAmB,KAAK,UAAU,EAAE,CAAC,CAAC;AAAA,EACxF;AACA,KAAG;AAAA,IACD,qDAAqD,mBAAmB,KAAK,UAAU,EAAE,CAAC,CAAC;AAAA,EAC7F;AAEA,SAAO;AACT;AAKO,SAAS,kBAAwB;AACtC,aAAW,MAAM;AACnB;;;AC3IA,IAAAC,UAAwB;AAQjB,IAAM,uBAAN,MAA8D;AAAA,EAC3D,yBAAyB,IAAW,qBAAmB;AAAA,EACtD,wBAAwB,KAAK,uBAAuB;AAAA,EAE7D,cAAc;AAEZ,mBAAe,YAAY,MAAM;AAC/B,WAAK,uBAAuB,KAAK;AAAA,IACnC,CAAC;AAAA,EACH;AAAA,EAEA,kBACE,UACA,QAC0C;AAC1C,UAAM,aAAgC,CAAC;AACvC,UAAM,OAAO,SAAS,QAAQ;AAC9B,UAAM,UAAU,IAAI,OAAO,uBAAuB,QAAQ,GAAG;AAC7D,UAAM,UAAU,oBAAI,IAAY;AAChC,QAAI;AAEJ,YAAQ,QAAQ,QAAQ,KAAK,IAAI,OAAO,MAAM;AAC5C,YAAM,SAAS,MAAM,CAAC;AAGtB,UAAI,QAAQ,IAAI,MAAM,GAAG;AACvB;AAAA,MACF;AACA,cAAQ,IAAI,MAAM;AAElB,YAAM,MAAM,SAAS,WAAW,MAAM,KAAK;AAC3C,YAAM,QAAQ,IAAW,cAAM,KAAK,GAAG;AAGvC,YAAM,OAAO,eAAe,QAAQ,MAAM;AAC1C,YAAM,YAAY,eAAe,aAAa,MAAM;AAGpD,YAAM,WAAW,eAAe,YAAY;AAC5C,cAAQ,IAAI,0BAA0B,MAAM,eAAe,SAAS,MAAM,kBAAkB,CAAC,CAAC,IAAI,EAAE;AAEpG,UAAI,MAAM;AAER,cAAM,OAAO,IAAW,iBAAS,OAAO;AAAA,UACtC,OAAO,GAAG,UAAU,MAAM,aAAa,UAAU,WAAW,IAAI,KAAK,GAAG;AAAA,UACxE,SAAS;AAAA,UACT,WAAW,CAAC,MAAM;AAAA,UAClB,SAAS,0BAA0B,KAAK,WAAW;AAAA,QACrD,CAAC;AACD,mBAAW,KAAK,IAAI;AAGpB,cAAM,UAAU,IAAW,iBAAS,OAAO;AAAA,UACzC,OAAO;AAAA,UACP,SAAS;AAAA,UACT,WAAW,CAAC,MAAM;AAAA,UAClB,SAAS,uBAAuB,KAAK,WAAW;AAAA,QAClD,CAAC;AACD,mBAAW,KAAK,OAAO;AAAA,MACzB,OAAO;AAEL,cAAM,OAAO,IAAW,iBAAS,OAAO;AAAA,UACtC,OAAO;AAAA,UACP,SAAS;AAAA,UACT,SAAS,QAAQ,MAAM;AAAA,QACzB,CAAC;AACD,mBAAW,KAAK,IAAI;AAAA,MACtB;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AACF;;;AChFA,IAAAC,UAAwB;AAOjB,IAAM,yBAAN,MAAkE;AAAA,EACvE,MAAM,kBACJ,UACA,UACA,QAC2D;AAE3D,UAAM,MAAM,2BAA2B,UAAU,QAAQ;AACzD,QAAI,CAAC,KAAK;AACR,aAAO;AAAA,IACT;AAGA,UAAM,WAAW,MAAM,0BAA0B,IAAI,EAAE;AACvD,QAAI,CAAC,UAAU;AACb,MAAO,eAAO,mBAAmB,8BAA8B,IAAI,EAAE,EAAE;AACvE,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AACF;;;ACjBO,IAAM,wBAAN,MAAgE;AAAA,EACrE,MAAM,kBACJ,UACA,UACA,SACA,QAC4B;AAE5B,UAAM,MAAM,2BAA2B,UAAU,QAAQ;AACzD,QAAI,CAAC,KAAK;AACR,aAAO,CAAC;AAAA,IACV;AAGA,UAAM,YAAY,MAAM,mBAAmB,IAAI,EAAE;AAGjD,QAAI,QAAQ,oBAAoB;AAC9B,YAAM,cAAc,MAAM,0BAA0B,IAAI,EAAE;AAC1D,UAAI,aAAa;AAEf,kBAAU,QAAQ,WAAW;AAAA,MAC/B;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AACF;;;ACtCA,IAAAC,UAAwB;AAYjB,IAAM,eAAN,cAAkC,iBAAS;AAAA,EAChD,YACkB,OACA,kBACA,UACA,QACA,UAChB;AACA,UAAM,OAAO,gBAAgB;AANb;AACA;AACA;AACA;AACA;AAKhB,SAAK,eAAe;AAGpB,YAAQ,UAAU;AAAA,MAChB,KAAK;AACH,aAAK,WAAW,IAAW,kBAAU,QAAQ;AAC7C;AAAA,MACF,KAAK;AACH,aAAK,WAAW,IAAW,kBAAU,WAAW;AAChD;AAAA,MACF,KAAK;AACH,aAAK,WAAW,IAAW,kBAAU,MAAM;AAC3C;AAAA,IACJ;AAGA,QAAI,aAAa,UAAU,QAAQ;AACjC,WAAK,UAAU;AAAA,QACb,SAAS;AAAA,QACT,OAAO;AAAA,QACP,WAAW,CAAC,MAAM;AAAA,MACpB;AAAA,IACF;AAAA,EACF;AACF;AAKO,IAAM,mBAAN,MAAwE;AAAA,EACrE,uBAAuB,IAAW,qBAA8C;AAAA,EAC/E,sBAAsB,KAAK,qBAAqB;AAAA,EAEzD,cAAc;AAEZ,mBAAe,YAAY,MAAM;AAC/B,WAAK,QAAQ;AAAA,IACf,CAAC;AAGD,IAAO,eAAO,4BAA4B,MAAM;AAC9C,WAAK,QAAQ;AAAA,IACf,CAAC;AAAA,EACH;AAAA,EAEA,UAAgB;AACd,SAAK,qBAAqB,KAAK;AAAA,EACjC;AAAA,EAEA,YAAY,SAAwC;AAClD,WAAO;AAAA,EACT;AAAA,EAEA,YAAY,SAA+D;AACzE,QAAI,CAAC,SAAS;AAEZ,aAAO,KAAK,kBAAkB;AAAA,IAChC;AAGA,QAAI,QAAQ,aAAa,YAAY;AACnC,YAAM,WAAW,QAAQ;AACzB,cAAQ,UAAU;AAAA,QAChB,KAAK;AACH,iBAAO,KAAK,oBAAoB;AAAA,QAClC,KAAK;AACH,iBAAO,KAAK,yBAAyB;AAAA,QACvC,KAAK;AACH,iBAAO,KAAK,eAAe;AAAA,QAC7B,KAAK;AACH,iBAAO,KAAK,gBAAgB;AAAA,QAC9B;AACE,iBAAO,CAAC;AAAA,MACZ;AAAA,IACF;AAGA,QAAI,QAAQ,aAAa,UAAU,QAAQ,UAAU;AACnD,aAAO,KAAK,eAAe,QAAQ,QAAQ;AAAA,IAC7C;AAGA,QAAI,QAAQ,aAAa,UAAU,QAAQ,QAAQ;AACjD,aAAO,KAAK,cAAc,QAAQ,MAAM;AAAA,IAC1C;AAEA,WAAO,CAAC;AAAA,EACV;AAAA,EAEQ,oBAAoC;AAC1C,UAAM,aAA6B,CAAC;AAGpC,UAAM,eAAsB,eAAO;AACnC,QAAI,cAAc;AAChB,iBAAW;AAAA,QACT,IAAI,aAAa,gBAAuB,iCAAyB,UAAU,UAAU;AAAA,MACvF;AAAA,IACF;AAGA,eAAW;AAAA,MACT,IAAI,aAAa,aAAoB,iCAAyB,WAAW,UAAU;AAAA,IACrF;AAGA,UAAM,UAAU,eAAe,SAAS,GAAG,WAAW,KAAK,CAAC;AAC5D,QAAI,QAAQ,SAAS,GAAG;AACtB,YAAM,OAAO,IAAI;AAAA,QACf;AAAA,QACO,iCAAyB;AAAA,QAChC;AAAA,MACF;AACA,WAAK,cAAc,GAAG,QAAQ,MAAM;AACpC,iBAAW,KAAK,IAAI;AAAA,IACtB;AAGA,eAAW;AAAA,MACT,IAAI,aAAa,iBAAwB,iCAAyB,WAAW,UAAU;AAAA,IACzF;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,sBAAsC;AAC5C,UAAM,eAAsB,eAAO;AACnC,QAAI,CAAC,cAAc;AACjB,aAAO,CAAC;AAAA,IACV;AAEA,UAAM,WAAkB,kBAAU,eAAe,aAAa,SAAS,GAAG;AAC1E,UAAM,QAAQ,eAAe,eAAe,QAAQ;AAEpD,WAAO,KAAK,gBAAgB,MAAM,OAAO,OAAK,CAAC,EAAE,WAAW,MAAM,CAAC;AAAA,EACrE;AAAA,EAEQ,2BAA2C;AACjD,UAAM,WAAW,eAAe,YAAY;AAC5C,UAAM,SAAS,oBAAI,IAAoB;AAEvC,eAAW,QAAQ,UAAU;AAC3B,UAAI,KAAK,WAAW,OAAQ;AAC5B,YAAM,OAAO,KAAK,WAAW,QAAQ;AACrC,YAAM,WAAW,OAAO,IAAI,IAAI,KAAK,CAAC;AACtC,eAAS,KAAK,IAAI;AAClB,aAAO,IAAI,MAAM,QAAQ;AAAA,IAC3B;AAEA,UAAM,QAAwB,CAAC;AAC/B,UAAM,cAAc,CAAC,GAAG,OAAO,KAAK,CAAC,EAAE,KAAK;AAE5C,eAAW,QAAQ,aAAa;AAC9B,YAAM,YAAY,OAAO,IAAI,IAAI,KAAK,CAAC;AACvC,YAAM,OAAO,IAAI;AAAA,QACf;AAAA,QACO,iCAAyB;AAAA,QAChC;AAAA,QACA;AAAA,QACA;AAAA,MACF;AACA,WAAK,cAAc,GAAG,UAAU,MAAM,QAAQ,UAAU,WAAW,IAAI,KAAK,GAAG;AAC/E,YAAM,KAAK,IAAI;AAAA,IACjB;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,eAAe,UAAkC;AACvD,UAAM,QAAQ,eAAe,eAAe,QAAQ;AACpD,WAAO,KAAK,gBAAgB,MAAM,OAAO,OAAK,CAAC,EAAE,WAAW,MAAM,CAAC;AAAA,EACrE;AAAA,EAEQ,iBAAiC;AACvC,UAAM,UAAU,eAAe,SAAS,GAAG,WAAW,KAAK,CAAC;AAC5D,WAAO,KAAK,gBAAgB,OAAO;AAAA,EACrC;AAAA,EAEQ,kBAAkC;AACxC,UAAM,UAAU,eAAe,SAAS,GAAG,WAAW,EAAE,KAAK,CAAC;AAC9D,WAAO,KAAK,gBAAgB,OAAO;AAAA,EACrC;AAAA,EAEQ,cAAc,UAAkC;AACtD,UAAM,SAAS,eAAe,QAAQ,QAAQ;AAC9C,QAAI,CAAC,OAAQ,QAAO,CAAC;AACrB,WAAO,KAAK,gBAAgB,OAAO,QAAQ;AAAA,EAC7C;AAAA,EAEQ,gBAAgB,OAA+B;AACrD,WAAO,MAAM,IAAI,UAAQ;AACvB,YAAM,cAAc,KAAK,SAAS,SAAS;AAC3C,YAAM,OAAO,IAAI;AAAA,QACf,KAAK;AAAA,QACL,cACW,iCAAyB,YACzB,iCAAyB;AAAA,QACpC;AAAA,QACA,KAAK,WAAW;AAAA,MAClB;AAGA,YAAM,gBAAgB,KAAK,WAAW,kBAAkB;AACxD,UAAI,gBAAgB,GAAG;AACrB,aAAK,cAAc,IAAI,aAAa;AAAA,MACtC;AAGA,YAAM,UAAU,KAAK,QAAQ,CAAC,GAAG,WAAW;AAC5C,WAAK,UAAU,IAAW;AAAA,QACxB,KAAK,KAAK,WAAW;AAAA;AAAA,EAAS,OAAO;AAAA;AAAA,GAAQ,KAAK,WAAW,MAAM,MAAM,KAAK,WAAW,OAAO;AAAA,MAClG;AAEA,aAAO;AAAA,IACT,CAAC;AAAA,EACH;AACF;;;AZnNA,eAAsB,SAAS,SAAkC;AAC/D,UAAQ,IAAI,sCAAsC;AAGlD,QAAM,cAAc,MAAM,eAAe,WAAW;AACpD,MAAI,CAAC,aAAa;AAChB,YAAQ,IAAI,8CAA8C;AAE1D,6BAAyB,OAAO;AAChC;AAAA,EACF;AAEA,UAAQ,IAAI,mCAAmC;AAG/C,QAAM,mBAA4C;AAAA,IAChD,EAAE,QAAQ,QAAQ,UAAU,WAAW;AAAA,IACvC,EAAE,QAAQ,QAAQ,UAAU,aAAa;AAAA,IACzC,EAAE,QAAQ,QAAQ,UAAU,kBAAkB;AAAA,IAC9C,EAAE,QAAQ,QAAQ,UAAU,aAAa;AAAA,IACzC,EAAE,QAAQ,QAAQ,UAAU,kBAAkB;AAAA,IAC9C,EAAE,QAAQ,QAAQ,UAAU,SAAS;AAAA,IACrC,EAAE,QAAQ,QAAQ,UAAU,KAAK;AAAA,IACjC,EAAE,QAAQ,QAAQ,UAAU,OAAO;AAAA,IACnC,EAAE,QAAQ,QAAQ,UAAU,OAAO;AAAA,EACrC;AAGA,QAAM,qBAA4B,kBAAU;AAAA,IAC1C;AAAA,IACA,IAAI,uBAAuB;AAAA,IAC3B;AAAA;AAAA,EACF;AAGA,QAAM,gBAAuB,kBAAU;AAAA,IACrC;AAAA,IACA,IAAI,kBAAkB;AAAA,EACxB;AAGA,QAAM,mBAA0B,kBAAU;AAAA,IACxC;AAAA,IACA,IAAI,qBAAqB;AAAA,EAC3B;AAGA,QAAM,qBAA4B,kBAAU;AAAA,IAC1C;AAAA,IACA,IAAI,uBAAuB;AAAA,EAC7B;AAGA,QAAM,oBAA2B,kBAAU;AAAA,IACzC;AAAA,IACA,IAAI,sBAAsB;AAAA,EAC5B;AAGA,QAAM,eAAe,IAAI,iBAAiB;AAC1C,QAAM,WAAkB,eAAO,eAAe,kBAAkB;AAAA,IAC9D,kBAAkB;AAAA,IAClB,iBAAiB;AAAA,EACnB,CAAC;AAGD,QAAM,iBAAwB,iBAAS,gBAAgB,oBAAoB,cAAc;AAEzF,QAAM,kBAAyB,iBAAS,gBAAgB,qBAAqB,eAAe;AAE5F,QAAM,wBAA+B,iBAAS;AAAA,IAC5C;AAAA,IACA;AAAA,EACF;AAEA,QAAM,qBAA4B,iBAAS;AAAA,IAAgB;AAAA,IAAwB,MACjF,aAAa,QAAQ;AAAA,EACvB;AAGA,UAAQ,cAAc;AAAA,IACpB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA,IAEA,eAAe,YAAY,MAAM,gBAAgB,CAAC;AAAA,EACpD;AAGA,EAAO,eAAO;AAAA,IACZ,oBAAoB,eAAe,YAAY,EAAE,MAAM;AAAA,EACzD;AACF;AAKA,SAAS,yBAAyB,SAAkC;AAClE,QAAM,cAAc,MAAM;AACxB,IAAO,eAAO;AAAA,MACZ;AAAA,IACF;AAAA,EACF;AAEA,UAAQ,cAAc;AAAA,IACb,iBAAS,gBAAgB,oBAAoB,WAAW;AAAA,IACxD,iBAAS,gBAAgB,qBAAqB,WAAW;AAAA,IACzD,iBAAS,gBAAgB,2BAA2B,WAAW;AAAA,EACxE;AACF;AAKA,eAAe,iBAAiB;AAC9B,QAAM,SAAgB,eAAO;AAC7B,MAAI,CAAC,QAAQ;AACX,IAAO,eAAO,mBAAmB,kBAAkB;AACnD;AAAA,EACF;AAGA,QAAM,YAAY,OAAO;AACzB,MAAI,UAAU;AAEd,MAAI,CAAC,UAAU,SAAS;AACtB,cAAU,OAAO,SAAS,QAAQ,SAAS;AAAA,EAC7C,OAAO;AAEL,cACG,MAAa,eAAO,aAAa;AAAA,MAChC,QAAQ;AAAA,MACR,aAAa;AAAA,IACf,CAAC,KAAM;AAAA,EACX;AAEA,MAAI,CAAC,SAAS;AACZ;AAAA,EACF;AAGA,QAAM,WAAW,oBAAoB,OAAO,SAAS,IAAI,MAAM;AAG/D,QAAM,OAAO,eAAe,QAAQ,UAAU,OAAO;AACrD,MAAI,MAAM;AACR,IAAO,eAAO,uBAAuB,mBAAmB,KAAK,WAAW,EAAE,IAAI;AAG9E,QAAI,UAAU,SAAS;AACrB,aAAO,KAAK,iBAAe;AACzB,oBAAY,OAAO,UAAU,QAAQ,KAAK,KAAK,WAAW,EAAE,IAAI,KAAK,WAAW,IAAI;AAAA,MACtF,CAAC;AAAA,IACH;AAAA,EACF,OAAO;AACL,IAAO,eAAO,iBAAiB,uBAAuB;AAAA,EACxD;AACF;AAKA,eAAe,gBAAgB,QAAiB;AAE9C,MAAI,CAAC,QAAQ;AACX,UAAM,QAAQ,eAAe,YAAY;AACzC,UAAM,QAA6B,MAAM,IAAI,WAAS;AAAA,MACpD,OAAO,KAAK;AAAA,MACZ,aAAa,KAAK,WAAW,QAAQ;AAAA,MACrC,QAAQ,KAAK,QAAQ,CAAC,GAAG,WAAW;AAAA,MACpC,QAAQ,KAAK,WAAW;AAAA,IAC1B,EAAE;AAEF,UAAM,WAAW,MAAa,eAAO,cAAc,OAAO;AAAA,MACxD,aAAa;AAAA,MACb,oBAAoB;AAAA,MACpB,eAAe;AAAA,IACjB,CAAC;AAED,QAAI,CAAC,UAAU;AACb;AAAA,IACF;AAEA,aAAS,SAAS;AAAA,EACpB;AAGA,QAAM,WAAW,MAAM,0BAA0B,MAAM;AACvD,MAAI,UAAU;AACZ,UAAM,WAAW,MAAa,kBAAU,iBAAiB,SAAS,GAAG;AACrE,UAAM,SAAS,MAAa,eAAO,iBAAiB,QAAQ;AAC5D,WAAO,YAAY,IAAW,kBAAU,SAAS,MAAM,OAAO,SAAS,MAAM,KAAK;AAClF,WAAO,YAAY,SAAS,OAAc,6BAAqB,QAAQ;AAAA,EACzE,OAAO;AACL,IAAO,eAAO,mBAAmB,mBAAmB,MAAM,EAAE;AAAA,EAC9D;AACF;AAKA,eAAe,sBAAsB,QAAiB;AAEpD,MAAI,CAAC,QAAQ;AACX,UAAMC,UAAgB,eAAO;AAC7B,QAAI,CAACA,SAAQ;AACX,MAAO,eAAO,mBAAmB,kBAAkB;AACnD;AAAA,IACF;AAGA,UAAM,WAAWA,QAAO,UAAU;AAClC,UAAM,OAAOA,QAAO,SAAS,OAAO,SAAS,IAAI,EAAE;AACnD,UAAM,UAAU;AAChB,QAAI;AAEJ,YAAQ,QAAQ,QAAQ,KAAK,IAAI,OAAO,MAAM;AAC5C,YAAM,QAAQ,MAAM;AACpB,YAAM,MAAM,QAAQ,MAAM,CAAC,EAAE;AAC7B,UAAI,SAAS,aAAa,SAAS,SAAS,aAAa,KAAK;AAC5D,iBAAS,MAAM,CAAC;AAChB;AAAA,MACF;AAAA,IACF;AAEA,QAAI,CAAC,QAAQ;AAEX,YAAM,QAAQ,eAAe,YAAY;AACzC,YAAM,QAA6B,MAAM,IAAI,WAAS;AAAA,QACpD,OAAO,KAAK;AAAA,QACZ,aAAa,GAAG,KAAK,WAAW,kBAAkB,CAAC;AAAA,QACnD,QAAQ,KAAK,WAAW;AAAA,MAC1B,EAAE;AAEF,YAAM,WAAW,MAAa,eAAO,cAAc,OAAO;AAAA,QACxD,aAAa;AAAA,MACf,CAAC;AAED,UAAI,CAAC,UAAU;AACb;AAAA,MACF;AAEA,eAAS,SAAS;AAAA,IACpB;AAAA,EACF;AAGA,QAAM,YAAY,MAAM,mBAAmB,MAAM;AAEjD,MAAI,UAAU,WAAW,GAAG;AAC1B,IAAO,eAAO,uBAAuB,2BAA2B,MAAM,EAAE;AACxE;AAAA,EACF;AAGA,QAAM,SAAgB,eAAO;AAC7B,MAAI,QAAQ;AACV,UAAa,iBAAS;AAAA,MACpB;AAAA,MACA,OAAO,SAAS;AAAA,MAChB,OAAO,UAAU;AAAA,MACjB;AAAA,MACA;AAAA,IACF;AAAA,EACF;AACF;AAKO,SAAS,aAAa;AAC3B,UAAQ,IAAI,wCAAwC;AACpD,iBAAe,QAAQ;AACvB,UAAQ,IAAI,iCAAiC;AAC/C;",
  "names": ["vscode", "indent", "collectNotes", "generateId", "generateId", "generateUniqueId", "isValidId", "generateDisplayPath", "extractIdFromRef", "parseDisplayPath", "vscode", "vscode", "indent", "vscode", "vscode", "vscode", "editor"]
}
